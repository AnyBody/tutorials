
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<meta content="noindex" name="robots" />

<meta property="og:title" content="Posture and Movement Prediction" />
  
<meta property="og:type" content="website" />
  
<meta property="og:url" content="https://anyscript.org/Posture_and_movement/intro.html" />
  
<meta property="og:site_name" content="AnyScript Tutorials" />
  
<meta property="og:description" content="Just about every example you find in these tutorials is based on the concept of inverse dynamics, which in some sense is the opposite of forward dynamics. To understand the difference between these..." />
  
<meta property="og:image" content="https://anyscript.org/_images/image136.png" />
  
<meta property="og:image:alt" content="kick1.png" />
  
    <title>Posture and Movement Prediction &#8212; AnyBody Tutorials v7.4.0-dev</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=e29d1d5dcac6d41e1d5489fedd7eec00fae8909a" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script src="../_static/design-tabs.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="User interface features" href="../Interface_features/index.html" />
    <link rel="prev" title="Lesson 2: Including a custom scaling function into your model" href="../Scaling/lesson4.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/AnyBodyTutorials2.svg" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../GettingStarted.html">
   <strong>
    Getting Started
   </strong>
  </a>
  <input checked class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../A_Getting_started/index.html">
     Getting Started - First steps
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started/intro.html">
       Getting Started Tutorial
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started/lesson1.html">
       Lesson 1: Creating a Standing Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started/lesson2.html">
       Lesson 2: Controlling the Posture
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started/lesson3.html">
       Lesson 3: Reviewing Analysis Results
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../A_Getting_started_anyscript/index.html">
     How to write AnyScript
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started_anyscript/intro.html">
       Introduction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started_anyscript/lesson1.html">
       Lesson 1: Basic Concepts
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started_anyscript/lesson2.html">
       Lesson 2: Defining Segments and Displaying Objects
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started_anyscript/lesson3.html">
       Lesson 3: Connecting Segments by Joints
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started_anyscript/lesson4.html">
       Lesson 4: Imparting movement with Drivers
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started_anyscript/lesson5.html">
       Lesson 5: Definition of Muscles and External Forces
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started_anyscript/lesson6.html">
       Lesson 6: Adding Real Bone Geometries
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../A_Getting_started_modeling/index.html">
     Modelling the Human body
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started_modeling/intro.html">
       Introduction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started_modeling/lesson1.html">
       Lesson 1: Starting with a New Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started_modeling/lesson2.html">
       Lesson 2: Adjusting the Human Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started_modeling/lesson3.html">
       Lesson 3: Making Ends Meet
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started_modeling/lesson4.html">
       Lesson 4: Kinetics - Computing Forces
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../A_Getting_started_AMMR/index.html">
     The AnyBody Model Repository
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
    <label for="toctree-checkbox-5">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference external" href="https://anyscript.org/ammr-doc/creating_model_from_scratch.html">
       Creating a Human Model from scratch
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference external" href="https://anyscript.org/ammr-doc/Scaling/lesson1.html">
       Scaling: Joint to joint scaling
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference external" href="https://anyscript.org/ammr-doc/Scaling/lesson2.html">
       Scaling: External Body Measurements
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference external" href="https://anyscript.org/ammr-doc/Scaling/lesson3.html">
       Scaling: Segmental scaling factors
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../Tutorials.html">
   <strong>
    Tutorials
   </strong>
  </a>
  <input checked class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../A_study_of_studies/index.html">
     A Study of Studies
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
    <label for="toctree-checkbox-7">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_study_of_studies/intro.html">
       Introduction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_study_of_studies/lesson1.html">
       Lesson1: Mechanical System Information
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_study_of_studies/lesson2.html">
       Lesson2: Initial Conditions
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_study_of_studies/lesson3.html">
       Lesson 3: Kinematic Analysis
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_study_of_studies/lesson4.html">
       Lesson 4: Inverse Dynamics
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../Making_things_move/index.html">
     Making things move
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
    <label for="toctree-checkbox-8">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../Making_things_move/intro.html">
       Introduction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Making_things_move/lesson1.html">
       Lesson1: Simple drivers
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Making_things_move/lesson2.html">
       Lesson 2: Using motion capture data
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Making_things_move/lesson3.html">
       Lesson3: Noise and filters
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Making_things_move/lesson4.html">
       Lesson 4: Parameter identification
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Making_things_move/lesson5.html">
       Lesson 5: Using real data
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Making_things_move/lesson6.html">
       Lesson 6: Troubleshooting C3D files
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../MuscleRecruitment/index.html">
     Inverse Dynamics of Muscle Systems
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
    <label for="toctree-checkbox-9">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../MuscleRecruitment/Inverse_dynamics.html">
       Introduction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../MuscleRecruitment/lesson1.html">
       Lesson 1: The Basics of Muscle Recruitment
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../MuscleRecruitment/lesson2.html">
       Lesson 2: Linear Muscle Recruitment
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../MuscleRecruitment/lesson3.html">
       Lesson 3: Quadratic Muscle Recruitment
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../MuscleRecruitment/lesson4.html">
       Lesson 4: Polynomial Muscle Recruitment
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../MuscleRecruitment/lesson5.html">
       Lesson 5: Min/Max Muscle Recruitment
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../MuscleRecruitment/lesson6.html">
       Lesson 6: Composite Recruitment Criteria
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../MuscleRecruitment/lesson_calibration.html">
       Lesson 7: Calibration
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../Muscle_modeling/index.html">
     Muscle Modeling
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
    <label for="toctree-checkbox-10">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../Muscle_modeling/intro.html">
       Introduction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Muscle_modeling/lesson1.html">
       Lesson 1: The Basics of Muscle Definition
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Muscle_modeling/lesson2.html">
       Lesson 2: Controlling Muscle Drawing
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Muscle_modeling/lesson3.html">
       Lesson 3: Via-point Muscles
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Muscle_modeling/lesson4.html">
       Lesson 4: Wrapping Muscles
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Muscle_modeling/lesson5.html">
       Lesson 5: Muscle Models
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Muscle_modeling/lesson6.html">
       Lesson 6: General Muscles
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Muscle_modeling/lesson7.html">
       Lesson 7: Ligaments
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../The_mechanical_elements/index.html">
     The Mechanical Elements
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
    <label for="toctree-checkbox-11">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../The_mechanical_elements/intro.html">
       Introduction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../The_mechanical_elements/lesson1.html">
       Lesson 1: Segments
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../The_mechanical_elements/lesson2.html">
       Lesson 2: Joints
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../The_mechanical_elements/lesson3.html">
       Lesson 3: Drivers
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../The_mechanical_elements/lesson4.html">
       Lesson 4: Kinematic Measures
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../The_mechanical_elements/lesson5.html">
       Lesson 5: Forces
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../ForceDependentKinematics/index.html">
     Force-Dependent Kinematics
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
    <label for="toctree-checkbox-12">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../ForceDependentKinematics/fdk.html">
       Introduction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../ForceDependentKinematics/lesson1.html">
       Lesson 1: The Baseline Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../ForceDependentKinematics/lesson2.html">
       Lesson 2: Adding FDK Features
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../ForceDependentKinematics/lesson3.html">
       Lesson 3: Results of FDK
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../ForceDependentKinematics/lesson4.html">
       Lesson 4: Using Surfaces to Define the Knee Joint
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../ForceDependentKinematics/lesson5.html">
       Lesson 5: Using Contact Forces to Replace a Joint in a Human Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../ForceDependentKinematics/fdkappendix.html">
       FDK appendix
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../Parameter_studies_and_optimization/index.html">
     Parameter Studies and Optimization
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
    <label for="toctree-checkbox-13">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../Parameter_studies_and_optimization/intro.html">
       Introduction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Parameter_studies_and_optimization/lesson1.html">
       Defining a Parameter Study
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Parameter_studies_and_optimization/lesson2.html">
       Optimization Studies
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Parameter_studies_and_optimization/lesson3.html">
       Optimization Studies in Python
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../Finite_element_analysis/index.html">
     Finite Element Analysis Interfacing
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
    <label for="toctree-checkbox-14">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../Finite_element_analysis/lesson1.html">
       Lesson 1: Export of data for FEA
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Finite_element_analysis/lesson2.html">
       Lesson 2: ANSYS Interface
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Finite_element_analysis/lesson3.html">
       Lesson 3: Abaqus Interface
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../AnyExp4SOLIDWORKS/index.html">
     Making Models using SOLIDWORKS
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
    <label for="toctree-checkbox-15">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../AnyExp4SOLIDWORKS/lesson1.html">
       Translating a SOLIDWORKS CAD model to AnyBody
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../AnyExp4SOLIDWORKS/lesson2.html">
       Making the translated AnyScript model move
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../AnyExp4SOLIDWORKS/lesson3.html">
       Creating human-machine integrated analysis model
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../Scaling/index.html">
     Scaling and Personalizing your model
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
    <label for="toctree-checkbox-16">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../Scaling/lesson3.html">
       Lesson 1: Scaling based on medical images
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
      <label for="toctree-checkbox-17">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../Scaling/lesson3_appendix.html">
         Lesson 1 appendix
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Scaling/lesson4.html">
       Lesson 2: Including a custom scaling function into your model
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Posture and Movement Prediction
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../Interface_features/index.html">
     User interface features
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/>
    <label for="toctree-checkbox-18">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../Interface_features/intro.html">
       Introduction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Interface_features/lesson1.html">
       Lesson 1: The Editor Window
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Interface_features/lesson2.html">
       Lesson 2: The Model View Window
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Interface_features/lesson3.html">
       Lesson 3: The Chart View
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Interface_features/lesson4.html">
       Lesson 4: The Model Tree and Object Description
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Interface_features/lesson5.html">
       Lesson 5: The Command Line Application
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Interface_features/lesson6.html">
       Lesson 6: Modifying the Loaded Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Interface_features/lesson7.html">
       Lesson 7: Wrapping the Model with AnyBody Project
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../Advanced_script_features/index.html">
     Advanced Script Features
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/>
    <label for="toctree-checkbox-19">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../Advanced_script_features/lesson1.html">
       Lesson 1: Using References
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Advanced_script_features/lesson2.html">
       Lesson 2: Using Include Files
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Advanced_script_features/lesson3.html">
       Lesson 3: Mathematical Expressions
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Troubleshooting_anyscript/intro.html">
     Trouble Shooting AnyScript Models
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../Validation_of_models/index.html">
     Validation of Models
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/>
    <label for="toctree-checkbox-20">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../Validation_of_models/intro.html">
       Introduction to validation
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Validation_of_models/Kinematic_input.html">
       Validating Kinematic input
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../about.html">
   <strong>
    About
   </strong>
  </a>
  <input checked class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/>
  <label for="toctree-checkbox-21">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../contributing.html">
     Help improve tutorials
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../legal.html">
     Legal, Trademarks and Copyrights
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Tutorials by <a href="https://anybodytech.com">AnyBody Technology</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/anybody/anybody-tutorial/issues/new?title=Issue%20on%20page%20%2FPosture_and_movement/intro.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/anybody/anybody-tutorial/edit/master/Posture_and_movement/intro.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#definition-of-the-problem">
   Definition of the Problem
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-football-kick">
   A Football Kick
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-optimization-problem">
   The Optimization Problem
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Posture and Movement Prediction</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#definition-of-the-problem">
   Definition of the Problem
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-football-kick">
   A Football Kick
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-optimization-problem">
   The Optimization Problem
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="posture-and-movement-prediction">
<h1>Posture and Movement Prediction<a class="headerlink" href="#posture-and-movement-prediction" title="Permalink to this headline">#</a></h1>
<div class="caution margin admonition">
<p class="admonition-title"><strong>Old tutorial:</strong></p>
<p>This tutorial has not yet been updated to ver. 7 of the AnyBody Modeling System. Some concepts may have changed.</p>
</div>
<p>Just about every example you find in these tutorials is based on the
concept of inverse dynamics, which in some sense is the opposite of
forward dynamics. To understand the difference between these two
concepts it is useful to have a brief look at Newton’s second law. It
states the following:</p>
<p><strong>F</strong> = <em>m</em> <strong>a</strong></p>
<p>where <strong>F</strong> is the vector of resulting forces acting on a body with mass
<em>m</em> causing an acceleration vector, <strong>a</strong>. So, if we know the
acceleration, i.e. the movement of the system, then we can find the
forces acting on it. That is inverse dynamics, and this is why AnyBody
usually requires us to specify the movement or posture of the model
before it can compute anything for us.</p>
<p>But we can also re-arrange the equation to this form:</p>
<p><strong>a</strong> = <strong>F</strong>/m</p>
<p>In this version, if we know the forces, we can determine the movement.
This is called forward dynamics. The problem with forward dynamics is
that input to the analysis will be some information about the muscle
forces and this is usually hard to determine experimentally and even
more difficult to guess.</p>
<p>But what if we know neither the movement nor the muscle forces? In that
case we have two unknowns and only one equation and it seems like our
venture into musculoskeletal analysis is destined to failure no matter
what we do. This tutorial shows how the optimization capability in
AnyBody can help you solve that kind of problems. They technically go
under the name “Posture and Motion Prediction” and the idea is that
rather than inputting a known posture or movement we want the model to
predict how a human body is likely going to move in a given situation.
Since this involves optimization and optimization takes time we are
going to formulate a very simple problem, but the principle applies to
much more complex models as well.</p>
<p>Understanding this tutorial requires a-priory knowledge of the tutorial
on <a class="reference internal" href="../Parameter_studies_and_optimization/intro.html"><span class="doc">Parameter Studies and Optimization</span></a>.</p>
<section id="definition-of-the-problem">
<h2>Definition of the Problem<a class="headerlink" href="#definition-of-the-problem" title="Permalink to this headline">#</a></h2>
<p>As the name indicates, in posture and movement optimization we use
optimization to compensate for the fact that we do not know the movement
a-priori. So, instead of feeding the movement to the analysis we have to
feed something into an optimization problem, and that something has to
be the ultimate goal of the movement.</p>
<p>For some movements this goal is quite obvious. The objective of a high
jump, for instance, is to jump as high as possible, so we could simply
ask the optimizer to determine the movement pattern that leads to the
highest possible jump. Of course it would not be allowed to have
movements that require more muscle strength than the body has available,
so we would also have to formulate a constraint ensuring that the
maximum muscle activation stays below 100%.</p>
<p>For other movements the goal is less clear. If we want to predict the
movement of lifting a coffee cup from the table to the mouth then what
would a reasonable goal be? The constraints are rather easy: Start at
the table, end at the mouth, keep the cup horizontal all the time, avoid
accelerations that would spill the coffee and so on, but many different
movements would honor those conditions. Which of them would be the one a
given person would actually choose? Some investigations indicate that
for submaximal tasks like this, a lazyness criterion often applies; we
try to get around the task as effortlessly as possible in some sense.
But we really do not know. In this case, the user could try different
objectives and decide on one that leads to a plausible movement.</p>
</section>
<section id="a-football-kick">
<h2>A Football Kick<a class="headerlink" href="#a-football-kick" title="Permalink to this headline">#</a></h2>
<p>So we need a simple model to play with. We are going to try to optimize
a two-dimensional football kick. There are all sorts of reasons why a
simple model of this task might be totally inadequate, but it will serve
well to demonstrate the idea. Please download a model to begin on.
<a class="reference download internal" download="" href="../_downloads/be106906cd405368538ae5a50916fff8/Kick1.any"><code class="xref download docutils literal notranslate"><span class="pre">Right-click</span> <span class="pre">the</span> <span class="pre">link</span> <span class="pre">and</span> <span class="pre">save</span> <span class="pre">the</span> <span class="pre">fileKick1.any</span></code></a> in some working directory. Then open
it up in the AnyBody Modeling System, load it in and open a Model View
window to have a look at the model. You should see something like this
(except the legends):</p>
<p><img alt="kick1.png" src="../_images/image136.png" /></p>
<p>It is a two-segment model with revolute joints at the hip and the knee,
so it has in total two degrees of freedom. Let us imagine that no motion
capture experiment has been performed, so we do not really know how the
model will kick. But we have made the initial guess that both of the two
joints are moving with constant velocity just to have some movement to
look at. Please select the InverseDynamicAnalysis operation and run it.
You will be rewarded with a very fast analysis but should be able to see
that the leg performs a kick.</p>
<p>The system also gives you the following warning:</p>
<p><em>MyStudy</em> : The muscles in the model are not loaded due to kinetically
over-constrained mechanical system.</p>
<p><em>MyStudy.InverseDynamics</em> : No muscles in the model. 49) …Inverse
dynamic analysis completed</p>
<p>We get this message because the model has no muscles and the necessary
joint torques to produce the movement are provided by the drivers. We
are going to want the model to relate to realistic joint strengths as
opposed to the infinitely strong driver reaction moments. On the other
hand we want to keep it simple. So rather than defining a lof of muscles
representing the real anatomy of the leg we shall just add “joint
muscles” to the hip and knee joints representing realistic strengths. We
are going to need such joint muscles for flexion and extension
respectively for both of the two joints. The red lines below add such
muscles with realistic joint strengths in Newton-meter. For an
explanation of the use of the AnyGeneralMuscle class, please refer to
the <a class="reference internal" href="../Muscle_modeling/intro.html"><span class="doc">muscle modeling tutorial</span></a>.</p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span><span class="kt">AnyKinEqSimpleDriver</span> <span class="n">KneeDriver</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">DriverPos</span> <span class="o">=</span> <span class="p">{</span><span class="o">-</span><span class="mi">90</span><span class="o">*</span><span class="kp">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">};</span>
  <span class="n">DriverVel</span> <span class="o">=</span> <span class="p">{</span><span class="mi">90</span><span class="o">*</span><span class="kp">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">}</span><span class="o">/</span><span class="p">..</span><span class="n">MyStudy</span><span class="p">.</span><span class="n">tEnd</span><span class="p">;</span>
  <span class="kt">AnyRevoluteJoint</span> <span class="o">&amp;</span><span class="n">Joint</span> <span class="o">=</span> <span class="p">.</span><span class="n">Knee</span><span class="p">;</span>
<span class="p">};</span>
<span class="gr">// Hip joint muscles</span>
<span class="gr">AnyGeneralMuscle HipFlex = {</span>
<span class="gr">  AnyMuscleModel Model = {F0 = 232;};</span>
<span class="gr">  ForceDirection = 1;</span>
<span class="gr">  AnyRevoluteJoint &amp;Joint = .Hip;</span>
<span class="gr">};</span>
<span class="gr">AnyGeneralMuscle HipExtend = {</span>
<span class="gr">  AnyMuscleModel Model = {F0 = 251;};</span>
<span class="gr">  ForceDirection = -1;</span>
<span class="gr">  AnyRevoluteJoint &amp;Joint = .Hip;</span>
<span class="gr">};</span>

<span class="gr">// Knee joint muscles</span>
<span class="gr">AnyGeneralMuscle KneeExtend = {</span>
<span class="gr">  AnyMuscleModel Model = {F0 = 554;};</span>
<span class="gr">  ForceDirection = 1;</span>
<span class="gr">  AnyRevoluteJoint &amp;Joint = .Knee;</span>
<span class="gr">};</span>
<span class="gr">AnyGeneralMuscle KneeFlex = {</span>
<span class="gr">  AnyMuscleModel Model = {F0 = 236;};</span>
<span class="gr">  ForceDirection = -1;</span>
<span class="gr">  AnyRevoluteJoint &amp;Joint = .Knee;</span>
<span class="gr">};</span>
</pre></div>
</div>
<p>Please copy and paste the red lines into your model just below the
KneeDriver definition as indicated. Then remove the reaction moments
from the drivers like this:</p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span><span class="kt">AnyKinEqSimpleDriver</span> <span class="n">HipDriver</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">DriverPos</span> <span class="o">=</span> <span class="p">{</span><span class="o">-</span><span class="mi">90</span><span class="o">*</span><span class="kp">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">};</span>
  <span class="n">DriverVel</span> <span class="o">=</span> <span class="p">{</span><span class="mi">90</span><span class="o">*</span><span class="kp">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">}</span><span class="o">/</span><span class="p">..</span><span class="n">MyStudy</span><span class="p">.</span><span class="n">tEnd</span><span class="p">;</span>
  <span class="gr">Reaction.Type = {Off};</span>
  <span class="kt">AnyRevoluteJoint</span> <span class="o">&amp;</span><span class="n">Joint</span> <span class="o">=</span> <span class="p">.</span><span class="n">Hip</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">AnyKinEqSimpleDriver</span> <span class="n">KneeDriver</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">DriverPos</span> <span class="o">=</span> <span class="p">{</span><span class="o">-</span><span class="mi">90</span><span class="o">*</span><span class="kp">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">};</span>
  <span class="n">DriverVel</span> <span class="o">=</span> <span class="p">{</span><span class="mi">90</span><span class="o">*</span><span class="kp">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">}</span><span class="o">/</span><span class="p">..</span><span class="n">MyStudy</span><span class="p">.</span><span class="n">tEnd</span><span class="p">;</span>
  <span class="gr">Reaction.Type = {Off};</span>
  <span class="kt">AnyRevoluteJoint</span> <span class="o">&amp;</span><span class="n">Joint</span> <span class="o">=</span> <span class="p">.</span><span class="n">Knee</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>After you reload and re-run the model you should be able to open a Chart
window, plot the MaxMuscleActivity and get this:</p>
<p><img alt="..." src="../_images/image229.png" /></p>
<p>The movement we have imposed is unrealistic. Both joints move with
constant angular velocity while, in a realistic case, the model should
capture the fact that it is necessary to accelerate the leg from some
start position to the velocity it has at impact. To obtain a realistic
and “designable” movement we have to replace the two simple drivers on
the hip and knee with something more general. The interpolation driver
is excellent for this purpose because it allows us to determine the
position of each joint in certain time steps through the kick and
subsequently will interpolate between those loctions to generate a
smooth motion.</p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span><span class="gr">//</span><span class="c1">    AnyKinEqSimpleDriver HipDriver = {</span>
<span class="gr">//</span><span class="c1">      DriverPos = {-90*pi/180};</span>
<span class="gr">//</span><span class="c1">      DriverVel = {90*pi/180}/..MyStudy.tEnd;</span>
<span class="gr">//</span><span class="c1">      Reaction.Type = {Off};</span>
<span class="gr">//</span><span class="c1">      AnyRevoluteJoint &amp;Joint = .Hip;</span>
<span class="gr">//</span><span class="c1">    };</span>
<span class="gr">//</span><span class="c1"></span>
<span class="gr">//</span><span class="c1">    AnyKinEqSimpleDriver KneeDriver = {</span>
<span class="gr">//</span><span class="c1">      DriverPos = {-90*pi/180};</span>
<span class="gr">//</span><span class="c1">      DriverVel = {90*pi/180}/..MyStudy.tEnd;</span>
<span class="gr">//</span><span class="c1">      Reaction.Type = {Off};</span>
<span class="gr">//</span><span class="c1">      AnyRevoluteJoint &amp;Joint = .Knee;</span>
<span class="gr">//</span><span class="c1">    };</span>

    <span class="gr">// Some initial guesses for the hip and knee angle</span>
<span class="gr">    // movements.</span>
<span class="gr">    AnyKinEqInterPolDriver HipDriver = {</span>
<span class="gr">      T = {0, 0.25, 0.50, 0.75, 1}*..MyStudy.tEnd;</span>
<span class="gr">      Data = {{-30, -30, -15, 0, 30}}*pi/180;</span>
<span class="gr">      Type = Bspline;</span>
<span class="gr">      BsplineOrder = 4;</span>
<span class="gr">      AnyRevoluteJoint &amp;Joint = .Hip;</span>
<span class="gr">      Reaction.Type = {Off};</span>
<span class="gr">    };</span>

<span class="gr">    AnyKinEqInterPolDriver KneeDriver = {</span>
<span class="gr">      T = {0, 0.25, 0.50, 0.75, 1}*..MyStudy.tEnd;</span>
<span class="gr">      Data = {{-70, -70, -50, -40, -30}}*pi/180;</span>
<span class="gr">      Type = Bspline;</span>
<span class="gr">      BsplineOrder = 4;</span>
<span class="gr">      AnyRevoluteJoint &amp;Joint = .Knee;</span>
<span class="gr">      Reaction.Type = {Off};</span>
<span class="gr">    };</span>
</pre></div>
</div>
<p>A fast reload and run of the model will show that the movement is
somewhat different now, and plotting the joint rotation velocities will
also show that the initial velocity is now zero for both joints. This is
ensured by using similar values for the first two points in each
interpolation, for instance -30 and -30 degrees in the HipDriver. Now we
could generate infinitely many different motions simply by inserting
different angle values into these interpolation drivers. Among them will
be the motion that generates the fastest kick without overloading the
muscles. Unfortunately, infinity is a very high number and we could
never finish searching for our solution and this is where the optimizer
can help us. We ask the optimizer to determine the best movement by
making these variations.</p>
</section>
<section id="the-optimization-problem">
<h2>The Optimization Problem<a class="headerlink" href="#the-optimization-problem" title="Permalink to this headline">#</a></h2>
<p>We already have some data now that can be used in the definition of our
optimization problem. The first question is: What do we actually want to
optimize? Given that the mass of the foot and football are given in
advance we can presume that maximising the velocity of the football
after the impact is equivalent to maximizing the velocity of the foot
before the impact. In fact, the law of conservation of momentum says
something about that. If we presume the mass of the football to be 0.2
kg, the coefficient of restitution of the collision to be 0.5, which is
typical for a football kick, and presume that the ball is at rest before
impact then we have enough information to predict the velocity of the
ball after the impact given the velocity of the foot before the impact.
We can write this formula directly into the model like this:</p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span> <span class="c1">// The study: Operations to be performed on the model</span>
 <span class="kt">AnyBodyStudy</span> <span class="n">MyStudy</span> <span class="o">=</span> <span class="p">{</span>
   <span class="kt">AnyFolder</span> <span class="o">&amp;</span><span class="n">Model</span> <span class="o">=</span> <span class="p">.</span><span class="n">MyModel</span><span class="p">;</span>
   <span class="n">RecruitmentSolver</span> <span class="o">=</span> <span class="kp">MinMaxSimplex</span><span class="p">;</span>
   <span class="n">Gravity</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.81</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">};</span>
   <span class="n">nStep</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span>
   <span class="n">tEnd</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">;</span>
   <span class="gr">AnyOutputFun BallVel= {</span>
<span class="gr">     Val =</span>
<span class="gr">1.5*Main.MyModel.Shank.Mass*Main.MyModel.Shank.rDot[0]/(0.2+Main.MyModel.Shank.Mass);</span>
<span class="gr">   };</span>
 <span class="p">};</span>
</pre></div>
</div>
<p> Please load and run the model again, and then go to the Chart window
and plot the new output function. You should see this:</p>
<p><img alt="kickvel1.gif" src="../_images/image34.gif" /></p>
<p>The function shows the predicted post-impact velocity of the ball if the
foot were to hit is at any time during the imposed movement. As
expected, the exit velocity is higher the later in the movement the ball
is hit because the foot velocity increases all the time.</p>
<p>We also want to be able to limit the muscle activation to prevent
overloading of the muscles, and we make a similar function for that
purpose:</p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span> <span class="c1">// The study: Operations to be performed on the model</span>
 <span class="kt">AnyBodyStudy</span> <span class="n">MyStudy</span> <span class="o">=</span> <span class="p">{</span>
   <span class="kt">AnyFolder</span> <span class="o">&amp;</span><span class="n">Model</span> <span class="o">=</span> <span class="p">.</span><span class="n">MyModel</span><span class="p">;</span>
   <span class="n">RecruitmentSolver</span> <span class="o">=</span> <span class="kp">MinMaxSimplex</span><span class="p">;</span>
   <span class="n">Gravity</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.81</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">};</span>
   <span class="n">nStep</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span>
   <span class="n">tEnd</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">;</span>
   <span class="kt">AnyOutputFun</span> <span class="n">BallVel</span><span class="o">=</span> <span class="p">{</span>
     <span class="n">Val</span> <span class="o">=</span>
<span class="mf">1.5</span><span class="o">*</span><span class="n">Main</span><span class="p">.</span><span class="n">MyModel</span><span class="p">.</span><span class="n">Shank</span><span class="p">.</span><span class="n">Mass</span><span class="o">*</span><span class="n">Main</span><span class="p">.</span><span class="n">MyModel</span><span class="p">.</span><span class="n">Shank</span><span class="p">.</span><span class="n">rDot</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mf">0.2</span><span class="o">+</span><span class="n">Main</span><span class="p">.</span><span class="n">MyModel</span><span class="p">.</span><span class="n">Shank</span><span class="p">.</span><span class="n">Mass</span><span class="p">);</span>
   <span class="p">};</span>
   <span class="gr">AnyOutputFun MaxAct = {</span>
<span class="gr">     Val = .MaxMuscleActivity;</span>
<span class="gr">   };</span>
 <span class="p">};</span>
</pre></div>
</div>
<p>With that we should be ready to define an optimization problem. A basic
optimization study would look like this:</p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span><span class="gr">// Optimize the ball velocity after the kick.</span>
<span class="gr">AnyOptStudy OptStudy = {</span>
<span class="gr">  LogFile = &quot;OptStudy.log&quot;;</span>
<span class="gr">  MaxIterationStep = 25;</span>

<span class="gr">  Analysis = {</span>
<span class="gr">    AnyOperation &amp;op = ..MyStudy.InverseDynamicAnalysis;</span>
<span class="gr">  };</span>

<span class="gr">  // Constraint: All muscle activities below 100%</span>
<span class="gr">  AnyDesMeasure MaxActivity = {</span>
<span class="gr">    Val = max(..MyStudy.MaxAct()-1);</span>
<span class="gr">    Type = LessThanZero;</span>
<span class="gr">  };</span>

<span class="gr">  // Objective function: Max horizontal velocity of the foot</span>
<span class="gr">  AnyDesMeasure KickVel = {</span>
<span class="gr">    Val = -max(..MyStudy.BallVel());</span>
<span class="gr">    Type = ObjectiveFun;</span>
<span class="gr">  };</span>
<span class="gr">};</span>
</pre></div>
</div>
<p>Please copy and paste those lines into the model right after the end of
MyStudy but before the final ending brace of the model. The study
contains two AnyDesMeasures of which the first is the maximum activity
minus one. The actual constraint is</p>
<p>max(Activity) &lt; 100%</p>
<p>but, because AnyBody requires zero right hand sides for all its
constraints, it is defined on the form</p>
<p>max(Activity) - 1&lt; 0</p>
<p>The second AnyDesMeasure, KickVel, is defined as minus the maximum of
the ball velocity. This is because AnyBody’s optimizer is set up to
always perform minimization where we want to maximize the velocity. So
we simply minimize the negative velocity instead. The max value is
derived first, presuming that the kicker will decide to hit the ball at
the optimal time in the kick.</p>
<p>Loading the model at this time will produce an error message because we
have not defined any design variables yet. Let us begin with a single
variable just to make sure we get it right before adding a lot of them:</p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span>    <span class="c1">// Objective function: Max horizontal velocity of the foot</span>
    <span class="kt">AnyDesMeasure</span> <span class="n">KickVel</span> <span class="o">=</span> <span class="p">{</span>
      <span class="n">Val</span> <span class="o">=</span> <span class="o">-</span><span class="nb">max</span><span class="p">(..</span><span class="n">MyStudy</span><span class="p">.</span><span class="n">BallVel</span><span class="p">());</span>
      <span class="n">Type</span> <span class="o">=</span> <span class="kp">ObjectiveFun</span><span class="p">;</span>
    <span class="p">};</span>

<span class="gr">    AnyVar slack = 60*pi/180;</span>
<span class="gr">    AnyDesVar Knee4 = {</span>
<span class="gr">      Val = Main.MyModel.KneeDriver.Data[0][3];</span>
<span class="gr">      Min = Val - .slack;</span>
<span class="gr">      Max = Val + .slack;</span>
<span class="gr">    };</span>
</pre></div>
</div>
<p>This design variable controls the position of the fourth data
point (remember that items in arrays are numbered from zero, so number
three is the fourth position) in the knee joint driver. There are five
point in total in each driver, but we do not want to include the last
one in the optimization because it determines the position of the foot
at the end of the analysis and we want this to be on the ball.</p>
<p>The variable names “slack” determines the upper and lower bound of the
variations of joint angle position. We have placed this in a variable
because it makes it easy to change the bounds simultaneously for all
design variables later.</p>
<p>If you reload the model now you can actually already do an optimization
with the single variable. Open the OptStudy branch of the tree on the
left hand side of the screen, highlight “Optimization”, and click “Run.
After a few moments the process will converge to a better kick. You can
see how much better by going to the Chart view, openeing the OptStudy
section and plotting “Main.OptStudy.Output.KickVel.Val”. You will see
that the optimization decreased the value from about -9 to about -12,
indicating an improvement of the ball velocity from 9 to 12 m/s.</p>
<p>Let us quickly add some more variables:</p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span><span class="kt">AnyVar</span> <span class="n">slack</span> <span class="o">=</span> <span class="mi">60</span><span class="o">*</span><span class="kp">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">;</span>
<span class="kt">AnyDesVar</span> <span class="n">Hip3</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">Val</span> <span class="o">=</span> <span class="n">Main</span><span class="p">.</span><span class="n">MyModel</span><span class="p">.</span><span class="n">HipDriver</span><span class="p">.</span><span class="n">Data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span>
  <span class="n">Min</span> <span class="o">=</span> <span class="o">-</span><span class="mi">30</span><span class="o">*</span><span class="kp">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">;</span>
  <span class="n">Max</span> <span class="o">=</span> <span class="n">Val</span> <span class="o">+</span> <span class="p">.</span><span class="n">slack</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">AnyDesVar</span> <span class="n">Hip4</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">Val</span> <span class="o">=</span> <span class="n">Main</span><span class="p">.</span><span class="n">MyModel</span><span class="p">.</span><span class="n">HipDriver</span><span class="p">.</span><span class="n">Data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">];</span>
  <span class="n">Min</span> <span class="o">=</span> <span class="n">Val</span> <span class="o">-</span> <span class="p">.</span><span class="n">slack</span><span class="p">;</span>
  <span class="n">Max</span> <span class="o">=</span> <span class="n">Val</span> <span class="o">+</span> <span class="p">.</span><span class="n">slack</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">AnyDesVar</span> <span class="n">Knee3</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">Val</span> <span class="o">=</span> <span class="n">Main</span><span class="p">.</span><span class="n">MyModel</span><span class="p">.</span><span class="n">KneeDriver</span><span class="p">.</span><span class="n">Data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span>
  <span class="n">Min</span> <span class="o">=</span> <span class="n">Val</span> <span class="o">-</span> <span class="p">.</span><span class="n">slack</span><span class="p">;</span>
  <span class="n">Max</span> <span class="o">=</span> <span class="n">Val</span> <span class="o">+</span> <span class="p">.</span><span class="n">slack</span><span class="p">;</span>
<span class="p">};</span><span class="gr"></span>
<span class="gr">AnyDesVar Knee4 = {</span>
<span class="gr">  Val = Main.MyModel.KneeDriver.Data[0][3];</span>
<span class="gr">  Min = Val - .slack;</span>
<span class="gr">  Max = Val + .slack;</span>
<span class="gr">};</span>
</pre></div>
</div>
<p>Notice how we have only added design variables for points 3 and 4 in
each joint angle interpolation. This is because we want to retain the
beginning and ending positions and we want to make sure the velocity in
the beginning remains zero, which is accomplished by keeping the second
point the same as the first point.</p>
<p>Running the optimization at this stage will make the problem converge in
a few interations to an optimized ball velocity of a little over 13 m/s.
If we plot the two joint accelerations we get:</p>
<p><img alt="kickacc1.gif" src="../_images/image42.gif" /></p>
<p>The movement shows subtle signs of a whiplash action in the sense that
the movement is initiated by a knee acceleration, which is taken over by
the hip acceleration, after which the peak knee acceleration sets in
after the hip acceleration has topped. However, more whiplash effect
could be expected and the final ball velocity of 13 m/s is not very
impressive for a football kick.</p>
<p>In other words, the movement is not entirely satisfactory. This could
likely be because the optimizer does not have enough freedom to control
the movement, and this can possibly be improved by adding additional
points to the interpolation and making them variables in the
optimization problem. Optimization problems are often ongoing projects
in the sense that is it difficult to know when the model is good enough
to capture the features of the body’s function that we are looking for.</p>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="../Scaling/lesson4.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Lesson 2: Including a custom scaling function into your model</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../Interface_features/index.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">User interface features</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By AnyBody Technology<br/>
  
      &copy; Copyright 2022, AnyBody Technology.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>