
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<meta content="noindex" name="robots" />

<meta property="og:title" content="Lesson 6: Adding Real Bone Geometries" />
  
<meta property="og:type" content="website" />
  
<meta property="og:url" content="https://anyscript.org/A_Getting_started_anyscript/lesson6.html" />
  
<meta property="og:site_name" content="AnyScript Tutorials" />
  
<meta property="og:description" content="So far the model graphically resembles a “stick figure representation”. However realistic bone geometries can improve both aesthetics and visual comprehension of a model’s anatomy, as illustrated b..." />
  
<meta property="og:image" content="https://anyscript.org/_images/image1.jpeg" />
  
<meta property="og:image:alt" content="oldleg1" />
  
    <title>Lesson 6: Adding Real Bone Geometries &#8212; AnyBody Tutorials v7.4.0-dev</title>
<script>
  document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
  document.documentElement.dataset.theme = localStorage.getItem("theme") || "light"
</script>

  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=92025949c220c2e29695" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=92025949c220c2e29695" rel="stylesheet">


  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />

  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/design-tabs.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3. Modelling the Human body" href="../A_Getting_started_modeling/index.html" />
    <link rel="prev" title="Lesson 5: Definition of Muscles and External Forces" href="lesson5.html" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">
    <div class="bd-header-announcement container-fluid" id="banner">
      

    </div>

    
    <nav class="bd-header navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="bd-header__inner container-xl">

  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../index.html">
  
  
  
  
    <img src="../_static/AnyBodyTutorials2.svg" class="logo__image only-light" alt="Logo image">
    <img src="../_static/AnyBodyTutorials2.svg" class="logo__image only-dark" alt="Logo image">
  
  
</a>
    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="fas fa-bars"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../GettingStarted.html">
  Getting Started
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../Tutorials.html">
  AnyBody Tutorials
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../about.html">
  About
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <span id="theme-switch" class="btn btn-sm btn-outline-primary navbar-btn rounded-circle">
    <a class="theme-switch" data-mode="light"><i class="fas fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="far fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fas fa-adjust"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/anybody/anybody-tutorial/" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="bd-container container-xl">
      <div class="bd-container__inner row">
          

<!-- Only show if we have sidebars configured, else just a small margin  -->
<div class="bd-sidebar-primary col-12 col-md-3 bd-sidebar">
  <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../A_Getting_started/index.html">
   1. Getting Started - First steps
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../A_Getting_started/intro.html">
     Getting Started Tutorial
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../A_Getting_started/lesson1.html">
     Lesson 1: Creating a Standing Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../A_Getting_started/lesson2.html">
     Lesson 2: Controlling the Posture
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../A_Getting_started/lesson3.html">
     Lesson 3: Reviewing Analysis Results
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="index.html">
   2. How to write AnyScript
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="intro.html">
     Introduction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="lesson1.html">
     Lesson 1: Basic Concepts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="lesson2.html">
     Lesson 2: Defining Segments and Displaying Objects
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="lesson3.html">
     Lesson 3: Connecting Segments by Joints
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="lesson4.html">
     Lesson 4: Imparting movement with Drivers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="lesson5.html">
     Lesson 5: Definition of Muscles and External Forces
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Lesson 6: Adding Real Bone Geometries
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../A_Getting_started_modeling/index.html">
   3. Modelling the Human body
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../A_Getting_started_modeling/intro.html">
     Introduction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../A_Getting_started_modeling/lesson1.html">
     Lesson 1: Starting with a New Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../A_Getting_started_modeling/lesson2.html">
     Lesson 2: Adjusting the Human Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../A_Getting_started_modeling/lesson3.html">
     Lesson 3: Making Ends Meet
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../A_Getting_started_modeling/lesson4.html">
     Lesson 4: Kinetics - Computing Forces
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../A_Getting_started_AMMR/index.html">
   4. The AnyBody Model Repository
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference external" href="https://anyscript.org/ammr-doc/creating_model_from_scratch.html">
     Creating a Human Model from scratch
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference external" href="https://anyscript.org/ammr-doc/Scaling/lesson1.html">
     Scaling: Joint to joint scaling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference external" href="https://anyscript.org/ammr-doc/Scaling/lesson2.html">
     Scaling: External Body Measurements
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference external" href="https://anyscript.org/ammr-doc/Scaling/lesson3.html">
     Scaling: Segmental scaling factors
    </a>
   </li>
  </ul>
 </li>
</ul>

  </div>
</nav>
  </div>
  <div class="sidebar-end-items">
  </div>
</div>


          


<div class="bd-sidebar-secondary d-none d-xl-block col-xl-2 bd-toc">
  
    
    <div class="toc-item">
      
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#file-formats-for-visualization-objects">
   File formats for visualization objects
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#importing-a-stl-file">
   Importing a STL file
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#relocating-your-stl-object">
   Relocating your STL object
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reorienting-your-stl-object">
   Reorienting your STL object
  </a>
 </li>
</ul>

</nav>
    </div>
    
    <div class="toc-item">
      

<div class="tocsection editthispage">
    <a href="https://github.com/anybody/anybody-tutorial/edit/master/./A_Getting_started_anyscript/lesson6.md">
        <i class="fas fa-pencil-alt"></i> Edit this page
    </a>
</div>

    </div>
    
  
</div>


          
          
          <div class="bd-content col-12 col-md-9 col-xl-7">
              
              <article class="bd-article" role="main">
                
  <section class="tex2jax_ignore mathjax_ignore" id="lesson-6-adding-real-bone-geometries">
<h1>Lesson 6: Adding Real Bone Geometries<a class="headerlink" href="#lesson-6-adding-real-bone-geometries" title="Permalink to this headline">#</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Here’s an AnyScript file to start on if you have not completed the
previous lesson: <a class="reference download internal" download="" href="../_downloads/7dc2455f13ddc5b1898ba5f7f02b7c9c/demo.lesson6.any"><code class="xref download docutils literal notranslate"><span class="pre">demo.lesson6.any</span></code></a>.</p>
</div>
<p>So far the model graphically resembles a “stick figure representation”.
However realistic bone geometries can improve both aesthetics and
visual comprehension of a model’s anatomy, as illustrated
by the two pictures below.</p>
<p><img alt="oldleg1" src="../_images/image1.jpeg" /> <img alt="oldleg2" src="../_images/image2.jpeg" /></p>
<section id="file-formats-for-visualization-objects">
<h2>File formats for visualization objects<a class="headerlink" href="#file-formats-for-visualization-objects" title="Permalink to this headline">#</a></h2>
<p>3-D Geometric models for model components such as bones can be specified using files
of the STL ASCII format.</p>
<p>STL is a very simple graphical file format that represents object surfaces as
triangles. Virtually all CAD systems can export an object in the STL format. So if your files are in the IGES,
STEP, DXF etc. formats, load them in your favorite CAD system and convert to STL.</p>
<p>STL files come in two varieties: ASCII and binary. AnyBody needs an ASCII file, so please make sure to choose that
option during the export process.</p>
</section>
<section id="importing-a-stl-file">
<h2>Importing a STL file<a class="headerlink" href="#importing-a-stl-file" title="Permalink to this headline">#</a></h2>
<p>Since the bone models shown in the above tutorial may be a bit too elaborate for a
basic tutorial, we will demonstrate this by adding an STL file for the dumbbel in the arm model.</p>
<p>Download the following model <a class="reference download internal" download="" href="../_downloads/0b4eb5f27a2aa589ba861ceefe40ee4f/dumbbell.stl"><code class="xref download docutils literal notranslate"><span class="pre">here(dumbell.stl)</span></code></a>.</p>
<p>The dumbbell STL should be added to the forearm, so add the following code - which imports the STL
file into AnyBody - within the “ArmModel.Segs.ForeArm” object:</p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span>  <span class="kt">AnyDrawSeg</span> <span class="n">DrwSeg</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="gr">AnyDrawSTL DrwSTL = {</span>
<span class="gr">    FileName = &quot;dumbbell.stl&quot;;</span>
<span class="gr">  };</span>
<span class="p">};</span> <span class="c1">// ForeArm</span>
</pre></div>
</div>
<p>Re-loading the model will result in a fully gray model view.</p>
<p>This is because the STL file’s units was millimeters, whereas the arm model
is in meters. This means the dumbbell’s STL swallowed up the entire arm model in the model view.
We will therefore scale the dumbbell model down a 1000 times, in the following way:</p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span><span class="kt">AnyDrawSTL</span> <span class="n">DrwSTL</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">FileName</span> <span class="o">=</span> <span class="s">&quot;dumbbell.stl&quot;</span><span class="p">;</span>
  <span class="gr">ScaleXYZ = {0.001, 0.001, 0.001};</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Post re-loading, your model should resemble the figure below.The dumbbell is visible now and has the right size, but
it is sitting at the center of mass of the lower arm rather than at the hand, and is not oriented correctly.</p>
<p><img alt="ModelView dumbbell1" src="../_images/image3.jpeg" /></p>
</section>
<section id="relocating-your-stl-object">
<h2>Relocating your STL object<a class="headerlink" href="#relocating-your-stl-object" title="Permalink to this headline">#</a></h2>
<p>When you attach something to a segment, it is by default positioned
at the segment’s origin which is also its center of mass. (This was discussed earlier <a class="reference internal" href="lesson2.html#class-inserter"><span class="std std-ref">over here</span></a>)</p>
<p>Therfore moving the dumbbell to the hand is as simple as relocating the “DrwSTL” object
from the “ForeArm” folder to the “PalmNode” subfolder. Cut-paste the entire code for the
“DrwSTL” folder into “PalmNode”, as shown below:</p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span>  <span class="kt">AnyRefNode</span> <span class="n">PalmNode</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">sRel</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.27</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">};</span>
    <span class="gr">AnyDrawSTL DrwSTL = {</span>
<span class="gr">      FileName = &quot;dumbbell.stl&quot;;</span>
<span class="gr">      ScaleXYZ = {0.001, 0.001, 0.001};</span>
<span class="gr">    };</span>
  <span class="p">};</span>

  <span class="kt">AnyDrawSeg</span> <span class="n">DrwSeg</span> <span class="o">=</span> <span class="p">{};</span>
<span class="p">};</span> <span class="c1">// ForeArm</span>
</pre></div>
</div>
<p>Upon reloading, we see that the dumbbell attached to the
right location, but is still not oriented correctly.</p>
<p><img alt="ModelView dumbbell2" src="../_images/image4.jpeg" /></p>
</section>
<section id="reorienting-your-stl-object">
<h2>Reorienting your STL object<a class="headerlink" href="#reorienting-your-stl-object" title="Permalink to this headline">#</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can visualize a node’s local reference system, by selecting the node in the model tree
(e.g., “Main.ArmModel.Segs.ForeArm.PalmNode”) and right-clicking and selecting “Model View-&gt;This object-&gt;View”.</p>
</div>
<p>An STL (or other geometrical) object’s axes are always oriented parallel to the local coordinate system it is attached to.
By visualizing the palm node’s local reference system, you will realize that the dumbbell needs to be rotated 90 degrees
about the local Y-axis.</p>
<p><strong>Therefore to rotate the dumbbell by 90 degrees about the Y axis, you must rotate the “PalmNode” by 90 degrees w.r.t its parent
frame, i.e. the “ForeArm”. While the vector sRel denotes the “PalmNode’s” relative location,you can add a rotation matrix
ARel (optinal property) which will orient “PalmNode” w.r.t “ForeArm”.</strong></p>
<p>You can use the <code class="docutils literal notranslate"><span class="pre">RotMat</span></code> function to generate the 3x3 rotation matrix:</p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span><span class="kt">AnyRefNode</span> <span class="n">PalmNode</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">sRel</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.27</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">};</span>
  <span class="gr">ARel = RotMat(90*pi/180, y);</span>
  <span class="kt">AnyDrawSTL</span> <span class="n">DrwSTL</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">FileName</span> <span class="o">=</span> <span class="s">&quot;dumbbell.stl&quot;</span><span class="p">;</span>
    <span class="n">ScaleXYZ</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">};</span>
  <span class="p">};</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The dumbbell’s color can be changed adding the property RGB to the STL file reference:</p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span> <span class="kt">AnyDrawSTL</span> <span class="n">DrwSTL</span> <span class="o">=</span> <span class="p">{</span>
   <span class="n">FileName</span> <span class="o">=</span> <span class="s">&quot;dumbbell.stl&quot;</span><span class="p">;</span>
   <span class="n">ScaleXYZ</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">};</span>
   <span class="gr">RGB = {0.2,0.4,0.5};</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The RGB property specifies the blend of colors Red, Green, and Blue on a normalized scale of 0 to 1.</p>
<p><img alt="ModelView dumbbell3" src="../_images/image5.jpeg" /></p>
<p>This completes the Getting Started with AnyScript tutorial. The final
result of your efforts is in <a class="reference download internal" download="" href="../_downloads/e2b529ca3b68acc64c35ebe686bcc367/demo.arm2d.any"><code class="xref download docutils literal notranslate"><span class="pre">demo.arm2d.any</span></code></a>.</p>
</section>
</section>


              </article>
              

              
              <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="lesson5.html" title="previous page">
      <i class="fas fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title">Lesson 5: Definition of Muscles and External Forces</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="../A_Getting_started_modeling/index.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title"><span class="section-number">3. </span>Modelling the Human body</p>
  </div>
  <i class="fas fa-angle-right"></i>
  </a>
</div>
              </footer>
              
          </div>
          
      </div>
    </div>

  
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695"></script>

<footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    <p class="copyright">
    &copy; Copyright 2022, AnyBody Technology.<br>
</p>
  </div>
  
  <div class="footer-item">
    <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.5.0.<br>
</p>
  </div>
  
</div>
</footer>
  </body>
</html>