


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Lesson 2: Using motion capture data &#8212; AnyBody Tutorials v7.0.1.dev Documentation</title>
    <link rel="stylesheet" href="../_static/cloud.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noticia+Text|Open+Sans|Droid+Sans+Mono" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '7.0.1.dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/jquery.cookie.js"></script>
    <script type="text/javascript" src="../_static/cloud.base.js"></script>
    <script type="text/javascript" src="../_static/cloud.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Lesson3: Noise and filters" href="lesson3.html" />
    <link rel="prev" title="Lesson1: Simple drivers" href="lesson1.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <body>
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../contents.html" title="Table Of Contents"
             accesskey="C">toc</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="lesson3.html" title="Lesson3: Noise and filters"
             accesskey="N">next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="lesson1.html" title="Lesson1: Simple drivers"
             accesskey="P">previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">AnyBody Tutorials v7.0.1.dev Documentation</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Making things move</a> &#187;</li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="lesson-2-using-motion-capture-data">
<h1>Lesson 2: Using motion capture data<a class="headerlink" href="#lesson-2-using-motion-capture-data" title="Permalink to this headline">¶</a></h1>
<p>In biomechanics, we often want to make our models move as we have
measured in the laboratory and the measurement technique would often be
tracking of optical markers in space by means of synchronized cameras.
There are many such systems available commercially, but a common feature
of most of the systems is that they are capable of saving data on a
standard format called a C3D file. Such a file contains data of the
spatial trajectory of optical markers fixed to the object whose motion
we want to record. The C3D file can also contain analog data such as
force platform measurements or EMG. To make things easy, AnyBody can
read the data from a C3D file directly. Please download and save the
file <a class="reference download internal" href="../_downloads/pendulum.c3d" download=""><code class="xref download docutils literal"><span class="pre">pendulum.c3d</span></code></a> in the directory where
you saved the Pendulum.any file.</p>
<p>Then place the cursor in the editor window just before the AnyKinMotion
object, click the Classes tab, unfold the class list, and locate the
AnyInputC3D class. Right-click the class and choose “Insert Class
Template”.</p>
<div class="highlight-AnyScriptDoc"><div class="highlight"><pre><span></span><span class="kt">AnyInputC3D</span> <span class="o">&lt;</span><span class="n">ObjectName</span><span class="o">&gt;</span> <span class="o">=</span>
<span class="p">{</span>
  <span class="n">FileName</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
  <span class="c1">//ReadAllDataOnOff = On;</span>
  <span class="c1">//TruncateExtraCharsInNamesOnOff = On;</span>
  <span class="c1">//PointsScaleFactor = 1;</span>
  <span class="c1">//ConstructModelOnOff = On;</span>
  <span class="c1">//MarkerUseAllPointsOnOff = Off;</span>
  <span class="c1">//MarkerUseCamMaskOnOff = On;</span>
  <span class="c1">//MarkerIndices = ;</span>
  <span class="c1">//MarkerLabels = ;</span>
  <span class="c1">//MarkerFilterIndex = 0;</span>
  <span class="c1">//ProcessedDataFilterIndex = 0;</span>
  <span class="c1">//AnalogFilterIndex = -1;</span>
  <span class="cm">/*Filter =</span>
<span class="cm">  {</span>
<span class="cm">  z0 = ;</span>
<span class="cm">  AutomaticInitialConditionOnOff = On;</span>
<span class="cm">  FilterForwardBackwardOnOff = On;</span>
<span class="cm">  N = 2;</span>
<span class="cm">  W = ;</span>
<span class="cm">  Fs = 0;</span>
<span class="cm">  Fc = {10};</span>
<span class="cm">  Type = LowPass;</span>
<span class="cm">  };*/</span>
  <span class="c1">//WriteMarkerDataToFilesOnOff = Off;</span>
  <span class="c1">//MarkerScaleXYZ = {0.025, 0.025, 0.025};</span>
  <span class="c1">//MarkerRGB = {0.65, 0.65, 0.65};</span>
  <span class="c1">//MarkerDrawOnOff = On;</span>
  <span class="c1">//MarkerInterPolType = Bspline;</span>
  <span class="c1">//MarkerBsplineOrder = 8;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>As you can see, the class has a lot of settings, but for now we shall
only use two of them, namely FileName and ConstructChartOnOff. We also
give a name to the object:</p>
<div class="highlight-AnyScriptDoc"><div class="highlight"><pre><span></span><span class="kt">AnyInputC3D</span> <span class="gr">C3D</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">FileName</span> <span class="o">=</span> <span class="s">&quot;§pendulum.c3d§&quot;</span><span class="p">;</span>
  <span class="c1">//TruncateExtraCharsInNamesOnOff = On;</span>
  <span class="c1">//MakeNameUniqueStr = &quot;_&quot;;</span>
  <span class="c1">//PointsScaleFactor = 1;</span>
  <span class="c1">//ConstructModelOnOff = On;</span>
  <span class="gr">ConstructChartOnOff = Off;</span>
</pre></div>
</div>
<p>ConstructChartOnOff instructs the C3D object to not draw 3D
trajectories.</p>
<p>Now, try loading the model again. You may get the following error
message:</p>
<blockquote>
<div>Time, ‘t’, has an invalid value for this interpolation</div></blockquote>
<p>C3D files contain marker trajectories covering a certain time span and
what goes on outside that interval is undefined. Furthermore, the very
beginning and very end of that time span may not be useful for the
motion interpolation due to initial transients. If you have a C3D file
of unknown duration, then you somehow have to figure out its start and
end times to enable AnyBody to analyze it. A simple way to do this is to
allow AnyBody to load the file by temporarily disabling the study
section of your model. This will eliminate the study’s conflicting start
and end times. Just block-select the study section and click the
“Comment out” tool button over the editor window:</p>
<div class="highlight-AnyScriptDoc"><div class="highlight"><pre><span></span><span class="c1">// The study: Operations to be performed on the model</span>
<span class="gr">//  AnyBodyStudy MyStudy = {</span>
<span class="gr">//    AnyFolder &amp;Model = .MyModel;</span>
<span class="gr">//    Gravity = {0.0, -9.81, 0.0};</span>
<span class="gr">//  };</span>
</pre></div>
</div>
<p>Now the model should load with no problems, and you can go to the tree
view in the left hand side of the screen, click the Model tab and unfold
the MyModel tree down to the C3D object as shown below.</p>
<p><a class="reference internal" href="../_images/image129.png"><img alt="Model tree" src="../_images/image129.png" style="width: 2.60417in; height: 2.56250in;" /></a></p>
<p>A bit down in this object you find the Header section. When you unfold
it you get access to a number of basic properties of the C3D file. Each
time you double-click a property, a window will pop up and give you its
value. The important properties in question are these:</p>
<div class="highlight-AnyScriptDoc"><div class="highlight"><pre><span></span><span class="n">FirstFrameNo</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">LastFrameNo</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">VideoFrameRate</span> <span class="o">=</span> <span class="mi">100</span>
</pre></div>
</div>
<p>This shows that the file has a total of 1000 frames at 100 frames/sec,
i.e. the simulation time spans ten seconds. We can now go to the editor
window and remove the temporary double slashes in front of each line in
the study section.</p>
<div class="highlight-AnyScriptDoc"><div class="highlight"><pre><span></span><span class="c1">// The study: Operations to be performed on the model</span>
<span class="gr">AnyBodyStudy MyStudy = {</span>
<span class="gr">    AnyFolder &amp;Model = .MyModel;</span>
<span class="gr">    Gravity = {0.0, -9.81, 0.0};</span>
<span class="gr">};</span>
</pre></div>
</div>
<p>…and insert specifications of simulation time:</p>
<div class="highlight-AnyScriptDoc"><div class="highlight"><pre><span></span><span class="kt">AnyBodyStudy</span> <span class="n">MyStudy</span> <span class="o">=</span> <span class="p">{</span>
    <span class="kt">AnyFolder</span> <span class="o">&amp;</span><span class="n">Model</span> <span class="o">=</span> <span class="p">.</span><span class="n">MyModel</span><span class="p">;</span>
    <span class="n">Gravity</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.81</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">};</span>
<span class="gr">tStart = 0.05;</span>
<span class="gr">    tEnd = 9.95;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>There is also an automated way to handle the problem. The frame rate
variables we have just processed manually can also be referred to
directly in the study section, such that the tStart and tEnd parameters
automatically adapt to the C3D file. Try this instead:</p>
<div class="highlight-AnyScriptDoc"><div class="highlight"><pre><span></span><span class="kt">AnyBodyStudy</span> <span class="n">MyStudy</span> <span class="o">=</span> <span class="p">{</span>
  <span class="kt">AnyFolder</span> <span class="o">&amp;</span><span class="n">Model</span> <span class="o">=</span> <span class="p">.</span><span class="n">MyModel</span><span class="p">;</span>
  <span class="n">Gravity</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.81</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">};</span>
  <span class="gr">AnyIntVar FirstFrame = Main.MyModel.C3D.Header.FirstFrameNo;</span>
<span class="gr">  AnyIntVar LastFrame = Main.MyModel.C3D.Header.LastFrameNo;</span>
<span class="gr">  tStart = FirstFrame/Main.MyModel.C3D.Header.VideoFrameRate+2*Kinematics.ApproxVelAccPerturb;</span>
<span class="gr">  tEnd = LastFrame/Main.MyModel.C3D.Header.VideoFrameRate-2*Kinematics.ApproxVelAccPerturb;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Notice that we start the simulation <code class="docutils literal"><span class="pre">2*Kinematics.ApproxVelAccPerturb</span></code>
after the beginning of the recorded motion and we end it similarly
before the end of the recording. The variable
Kinematics.ApproxVelAccPerturb contains information about the
algorithm’s necessary elbow room on each side of the analyzed interval.
This eliminates possible numerical trouble with end points.</p>
<p>Now the model should load and the Model View window (open a new one if
you do not have it) will display a small, grey dot to the right of the
pendulum end.</p>
<p><a class="reference internal" href="../_images/image22.jpeg"><img alt="small dot" src="../_images/image22.jpeg" style="width: 2.60417in; height: 2.38542in;" /></a></p>
<p>The small dot is in fact the single marker contained in Pendulum.c3d. A
typical file from a real motion capture experiment can contain dozens of
markers, but in the interest of simplicity we have just included a
single one here. The AnyInputC3D object automatically creates the small
dots and the drivers necessary to move them around as they were
recorded. If you run the Kinematics operation (Click the Operation tab
in the tree view on the left hand side of the screen, select Kinematics
and click run), you will see the pendulum move as before, while the
marker performs an oscillating motion back and forth (Tip: if the motion
is too fast to see properly, increase the number of time steps, nStep,
in the study).</p>
<p>So how do we get the marker to drive the pendulum? This can be done
quite easily with the AnyKinDriverMarker object. The steps are:</p>
<ol class="arabic simple">
<li>Remove the existing driver that makes the pendulum rotate.</li>
<li>Drive the marker point, P1, on the pendulum to follow the data
recorded in the C3D file.</li>
</ol>
<p>Start by selecting the existing AnyKinMotion driver and comment it out
of the model. That takes care of step 1.</p>
<p>Then click the Classes tab on the left hand side of the editor window,
insert a new AnyKinDriverMarker template, and give it a name:</p>
<div class="highlight-AnyScriptDoc"><div class="highlight"><pre><span></span><span class="gr">AnyKinDriverMarker C3Dmotion =</span>
<span class="gr">  {</span>
<span class="gr">    //MeasureOrganizer = {};</span>
<span class="gr">    //CType = ;</span>
<span class="gr">    //WeightFun = {};</span>
<span class="gr">    //DriverPos0 = {};</span>
<span class="gr">    //DriverVel0 = {};</span>
<span class="gr">    //DriverAcc0 = {};</span>
<span class="gr">    AnyRefFrame &amp;&lt;Insert name0&gt; = &lt;Insert object reference (or full object definition)&gt;;</span>
<span class="gr">    //AnyRefFrame &amp;&lt;Insert name1&gt; = &lt;Insert object reference (or full object definition)&gt;;</span>
<span class="gr">    //AnyParamFun &amp;&lt;Insert name0&gt; = &lt;Insert object reference (or full object definition)&gt;;</span>
<span class="gr">  };</span>
</pre></div>
</div>
<p>Just as before, the AnyKinDriverMarker object needs to know what to
drive and what to drive it with. The “what to drive” part is the
position of P1 on the pendulum. This is specified with the first
reference frame in the object:</p>
<div class="highlight-AnyScriptDoc"><div class="highlight"><pre><span></span><span class="kt">AnyKinDriverMarker</span> <span class="n">C3Dmotion</span> <span class="o">=</span>
<span class="p">{</span>
    <span class="c1">//MeasureOrganizer = {};</span>
    <span class="c1">//CType = ;</span>
    <span class="c1">//WeightFun = {};</span>
    <span class="c1">//DriverPos0 = {};</span>
    <span class="c1">//DriverVel0 = {};</span>
    <span class="c1">//DriverAcc0 = {};</span>
    <span class="gr">AnyRefFrame &amp;Marker = .Pendulum.P1;</span>
    <span class="c1">//AnyRefFrame &amp;&lt;Insert name1&gt; = &lt;Insert object reference (or full object definition)&gt;;</span>
    <span class="c1">//AnyParamFun &amp;&lt;Insert name0&gt; = &lt;Insert object reference (or full object definition)&gt;;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The marker coordinates in the C3D file are recorded in the laboratory
coordinate system, which we chall assume is our global reference frame.
Driving from GlobalRef is default in linear measures, so we need not
mention GlobalRef explicitly in the AnyKinDriverMarker object.</p>
<p>We are going to drive the point directly by means of the interpolation
function specifying the marker trajectory in the C3D object. First, give
a reasonable name to the AnyParamFun and remove the stuff after the
equality sign:</p>
<div class="highlight-AnyScriptDoc"><div class="highlight"><pre><span></span><span class="kt">AnyKinDriverMarker</span> <span class="n">C3Dmotion</span> <span class="o">=</span>
<span class="p">{</span>
  <span class="c1">//MeasureOrganizer = {};</span>
  <span class="c1">//CType = ;</span>
  <span class="c1">//WeightFun = {};</span>
  <span class="c1">//DriverPos0 = {};</span>
  <span class="c1">//DriverVel0 = {};</span>
  <span class="c1">//DriverAcc0 = {};</span>
  <span class="kt">AnyRefFrame</span> <span class="o">&amp;</span><span class="n">Marker</span> <span class="o">=</span> <span class="p">.</span><span class="n">Pendulum</span><span class="p">.</span><span class="n">P1</span><span class="p">;</span>
  <span class="c1">//AnyRefFrame &amp;&lt;Insert name1&gt; = &lt;Insert object reference (or full object definition)&gt;;</span>
  <span class="kt">AnyParamFun</span> <span class="gr">&amp;Trajectory = ;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Then click the Model tab in the tree view on the left hand side of the
editor window, unfold the MyModel branch and subsequently the C3D
object, Points, Markers, L000 and arrive at PosInterpol as shown below.</p>
<p><a class="reference internal" href="../_images/image320.png"><img alt="Model tree 2" src="../_images/image320.png" style="width: 2.55208in; height: 2.94792in;" /></a></p>
<p>This is the actual interpolation function of the marker in question.
Place the cursor after the equality sign of the AnyParamFun line,
right-click the PosInterpol object, and choose “Insert object name”. You
should get this:</p>
<div class="highlight-AnyScriptDoc"><div class="highlight"><pre><span></span><span class="kt">AnyKinDriverMarker</span> <span class="n">C3Dmotion</span> <span class="o">=</span>
 <span class="p">{</span>
   <span class="c1">//MeasureOrganizer = {};</span>
   <span class="c1">//CType = ;</span>
   <span class="c1">//WeightFun = {};</span>
   <span class="c1">//DriverPos0 = {};</span>
   <span class="c1">//DriverVel0 = {};</span>
   <span class="c1">//DriverAcc0 = {};</span>
   <span class="kt">AnyRefFrame</span> <span class="o">&amp;</span><span class="n">Marker</span> <span class="o">=</span> <span class="p">.</span><span class="n">Pendulum</span><span class="p">.</span><span class="n">P1</span><span class="p">;</span>
   <span class="c1">//AnyRefFrame &amp;&lt;Insert name1&gt; = &lt;Insert object reference (or full object definition)&gt;;</span>
   <span class="kt">AnyParamFun</span> <span class="o">&amp;</span><span class="n">Trajectory</span> <span class="o">=</span>
   <span class="n">Main</span><span class="p">.</span><span class="n">MyModel</span><span class="p">.</span><span class="n">C3D</span><span class="p">.</span><span class="n">Points</span><span class="p">.</span><span class="n">Markers</span><span class="p">.</span><span class="n">L000</span><span class="p">.</span><span class="n">PosInterpol</span><span class="p">;</span>
 <span class="p">};</span>
</pre></div>
</div>
<p>Now load the model and run the kinematic analysis. You will get the
following error message::</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>Model is kinematically over-constrained : Position analysis failed : 2 unsolvable constraint(s) found
</pre></div>
</div>
<p>It is time to think back to the concept of degrees-of-freedom, DoF. In
the beginning of the tutorial, we established that the free pendulum has
one DoF. But the marker trajectory has three coordinates and therefore
wants to drive P1 of the pendulum in x, y and z, i.e. two DoFs more than
we have available. There are two possible solutions to this problem.
Either we pick only one of the directions given by the marker and let
the revolute joint decide the rest, or we have to accept that the
pendulum cannot follow the marker completely in all three DoFs, i.e.
something has to give.</p>
<p>Driving just one direction would be fairly simple in this case, but in a
more complicated model with many markers, the selection of a subset of
directions to drive can be a very tedious process. Another aspect to
consider is that marker data are measured and therefore always infested
with various types of errors and noise. One of the serious errors in
motion capture technology is the so-called soft tissue artifact or skin
artifact. It comes from the fact that markers are placed on the skin at
some distance from the bone whose motion they are supposed to record.
Between the marker and the bone are layers of skin, fat and muscle, so
the marker never moves exactly with the bone. It is therefore natural in
the model to presume that the connection between the marker and the bone
is not a rigid one, and when that is the case, AnyBody will accept
drivers on more DoFs than the model actually has.</p>
<p>Resolving the kinematics in the presence of moving markers is somewhat
more complicated numerically, so we have to ask for a specific
kinematics solver that can handle it. This is done in the study section:</p>
<div class="highlight-AnyScriptDoc"><div class="highlight"><pre><span></span><span class="kt">AnyBodyStudy</span> <span class="n">MyStudy</span> <span class="o">=</span> <span class="p">{</span>
  <span class="kt">AnyFolder</span> <span class="o">&amp;</span><span class="n">Model</span> <span class="o">=</span> <span class="p">.</span><span class="n">MyModel</span><span class="p">;</span>
  <span class="n">Gravity</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.81</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">};</span>
 <span class="kt">AnyIntVar</span> <span class="n">FirstFrame</span> <span class="o">=</span> <span class="n">Main</span><span class="p">.</span><span class="n">MyModel</span><span class="p">.</span><span class="n">C3D</span><span class="p">.</span><span class="n">Header</span><span class="p">.</span><span class="n">FirstFrameNo</span><span class="p">;</span>
  <span class="kt">AnyIntVar</span> <span class="n">LastFrame</span> <span class="o">=</span> <span class="n">Main</span><span class="p">.</span><span class="n">MyModel</span><span class="p">.</span><span class="n">C3D</span><span class="p">.</span><span class="n">Header</span><span class="p">.</span><span class="n">LastFrameNo</span><span class="p">;</span>
  <span class="n">tStart</span> <span class="o">=</span> <span class="n">FirstFrame</span><span class="o">/</span><span class="n">Main</span><span class="p">.</span><span class="n">MyModel</span><span class="p">.</span><span class="n">C3D</span><span class="p">.</span><span class="n">Header</span><span class="p">.</span><span class="n">VideoFrameRate</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">Kinematics</span><span class="p">.</span><span class="n">ApproxVelAccPerturb</span><span class="p">;</span>
  <span class="n">tEnd</span> <span class="o">=</span> <span class="n">LastFrame</span><span class="o">/</span><span class="n">Main</span><span class="p">.</span><span class="n">MyModel</span><span class="p">.</span><span class="n">C3D</span><span class="p">.</span><span class="n">Header</span><span class="p">.</span><span class="n">VideoFrameRate</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">Kinematics</span><span class="p">.</span><span class="n">ApproxVelAccPerturb</span><span class="p">;</span>
  <span class="gr">InitialConditions.SolverType = KinSolOverDeterminate;</span>
<span class="gr">  Kinematics.SolverType = KinSolOverDeterminate;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The two additional lines select a kinematic solver for the
InitialConditions and Kinematics operations that will accept more
kinematic constraints than the system has DoFs. Now you can reload and
run the kinematic analysis and you should see the pendulum following the
marker movement. You cannot see the marker during the movement because
it is hidden inside the pendulum. In fact, the marker is not strictly
necessary for the analysis and we can get rid of it altogether by an
additional specification in the C3D object:</p>
<div class="highlight-AnyScriptDoc"><div class="highlight"><pre><span></span><span class="kt">AnyInputC3D</span> <span class="n">C3D</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">FileName</span> <span class="o">=</span> <span class="s">&quot;pendulum.c3d&quot;</span><span class="p">;</span>
  <span class="c1">//ReadAllDataOnOff = On;</span>
  <span class="c1">//TruncateExtraCharsInNamesOnOff = On;</span>
  <span class="c1">//PointsScaleFactor = 1;</span>
  <span class="gr">ConstructModelOnOff = Off;</span>
  <span class="n">ConstructChartOnOff</span> <span class="o">=</span> <span class="kp">Off</span><span class="p">;</span>
  <span class="c1">//MarkerUseAllPointsOnOff = Off;</span>
  <span class="c1">//MarkerUseCamMaskOnOff = On;</span>
  <span class="c1">//MarkerIndices = ;</span>
  <span class="c1">//MarkerLabels = ;</span>
  <span class="c1">//MarkerFilterIndex = 0;</span>
  <span class="c1">//ProcessedDataFilterIndex = 0;</span>
  <span class="c1">//AnalogFilterIndex = -1;</span>
  <span class="cm">/*Filter =</span>
<span class="cm">  {</span>
<span class="cm">  z0 = ;</span>
<span class="cm">  AutomaticInitialConditionOnOff = On;</span>
<span class="cm">  FilterForwardBackwardOnOff = On;</span>
<span class="cm">  N = 2;</span>
<span class="cm">  W = ;</span>
<span class="cm">  Fs = 0;</span>
<span class="cm">  Fc = {10};</span>
<span class="cm">  Type = LowPass;</span>
<span class="cm">  };*/</span>
  <span class="c1">//WriteMarkerDataToFilesOnOff = Off;</span>
  <span class="c1">//MarkerScaleXYZ = {0.025, 0.025, 0.025};</span>
  <span class="c1">//MarkerRGB = {0.65, 0.65, 0.65};</span>
  <span class="c1">//MarkerDrawOnOff = On;</span>
  <span class="c1">//MarkerInterPolType = Bspline;</span>
  <span class="c1">//MarkerBsplineOrder = 8;</span>
</pre></div>
</div>
<p>With the unnecessary marker gone from the model, the kinematic analysis
runs much faster than before. Each marker adds DoFs and constraints to
the model, and they require solution time. It is therefore more
efficient to leave the markers out unless you really need them.</p>
<p>Now that there is driver between pendulum and the marker, it is possible
to simultaneously draw both the point on the pendulum and the marker
from the C3D file. To do this, start by placing the cursor inside the
AnyKinDriverMarker object.</p>
<p>Then click the Classes tab on the left hand side of the editor window,
insert a new AnyDrawKinMeasure template, and give it a name:</p>
<div class="highlight-AnyScriptDoc"><div class="highlight"><pre><span></span><span class="kt">AnyKinDriverMarker</span> <span class="n">C3Dmotion</span> <span class="o">=</span>
<span class="p">{</span>
  <span class="c1">//MeasureOrganizer = {};</span>
  <span class="c1">//CType = ;</span>
  <span class="c1">//WeightFun = {};</span>
  <span class="c1">//DriverPos0 = {};</span>
  <span class="c1">//DriverVel0 = {};</span>
  <span class="c1">//DriverAcc0 = {};</span>
  <span class="kt">AnyRefFrame</span> <span class="o">&amp;</span><span class="n">Marker</span> <span class="o">=</span> <span class="p">.</span><span class="n">Pendulum</span><span class="p">.</span><span class="n">P1</span><span class="p">;</span>
  <span class="c1">//AnyRefFrame &amp;&lt;Insert name1&gt; = &lt;Insert object reference (or full object definition)&gt;;</span>
  <span class="kt">AnyParamFun</span> <span class="o">&amp;</span><span class="n">Trajectory</span> <span class="o">=</span>
  <span class="n">Main</span><span class="p">.</span><span class="n">MyModel</span><span class="p">.</span><span class="n">C3D</span><span class="p">.</span><span class="n">Points</span><span class="p">.</span><span class="n">Markers</span><span class="p">.</span><span class="n">L000</span><span class="p">.</span><span class="n">PosInterpol</span><span class="p">;</span>

  <span class="gr">AnyDrawKinMeasure drw =</span>
<span class="gr">  {</span>
<span class="gr">    //Visible = On;</span>
<span class="gr">    //Opacity = 1;</span>
<span class="gr">    //RGB1 = {0.8, 0.3, 0.3};</span>
<span class="gr">    //RGB2 = {0.3, 0.8, 0.3};</span>
<span class="gr">    //RGB3 = {0.3, 0.3, 0.8};</span>
<span class="gr">    //RGB4 = {0.8, 0.5, 0.2};</span>
<span class="gr">    //Label = On;</span>
<span class="gr">    //Size = 0.02;</span>
<span class="gr">    //Line = On;</span>
<span class="gr">    //Text = &quot;&quot;;</span>
<span class="gr">    //TextSize = 30;</span>
<span class="gr">  };</span>
<span class="p">};</span>
</pre></div>
</div>
<p>If you reload the model, you should see something like this:</p>
<p><a class="reference internal" href="../_images/image42.jpeg"><img alt="Model view AnyKinDriver marker" src="../_images/image42.jpeg" style="width: 2.60417in; height: 2.52083in;" /></a></p>
<p>The blue dot illustrates the marker from the c3d file and the red line
is drawn to illustrate the difference between the point on the segment
and the measured point. Please notice that there is a small ball hidden
inside yellow sphere from the drawing of the segment. The plot also
shows a label “KDM”, which indicates that it is an AnyKinDriverMarker
that is drawn.</p>
<p>The line between the two points and the label can be removed by changing
the Label and Line settings to Off. Let us also change the size of the
dots such that we can see both the point on the segment as well as the
measured point.</p>
<div class="highlight-AnyScriptDoc"><div class="highlight"><pre><span></span><span class="kt">AnyDrawKinMeasure</span> <span class="n">drw</span> <span class="o">=</span>
<span class="p">{</span>
  <span class="c1">//Visible = On;</span>
  <span class="c1">//Opacity = 1;</span>
  <span class="c1">//RGB1 = {0.8, 0.3, 0.3};</span>
  <span class="c1">//RGB2 = {0.3, 0.8, 0.3};</span>
  <span class="c1">//RGB3 = {0.3, 0.3, 0.8};</span>
  <span class="c1">//RGB4 = {0.8, 0.5, 0.2};</span>
  <span class="gr">Label = Off;</span>
<span class="gr">  Size = 0.07;</span>
<span class="gr">  Line = Off; </span>
  <span class="c1">//Text = &quot;&quot;;</span>
  <span class="c1">//TextSize = 30;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Reloading the model should show you something like this:</p>
<p><a class="reference internal" href="../_images/image52.jpeg"><img alt="Model view DrawKinMeasure" src="../_images/image52.jpeg" style="width: 2.56250in; height: 2.81250in;" /></a></p>
<p>Let us briefly investigate the kinematic constraints of our model. Click
the Model tab in the tree view on the left hand side of the screen and
unfold the Joint branch. Inside you find Constraints, and after
unfolding that branch you find the property CType. If you double-click
it, the popup window shows the following:</p>
<div class="highlight-AnyScriptDoc"><div class="highlight"><pre><span></span><span class="n">CType</span> <span class="o">=</span> <span class="p">{</span><span class="kp">Hard</span><span class="p">,</span> <span class="kp">Hard</span><span class="p">,</span> <span class="kp">Hard</span><span class="p">,</span> <span class="kp">Hard</span><span class="p">,</span> <span class="kp">Hard</span><span class="p">}</span>
</pre></div>
</div>
<p>CType appears to be a vector with five components, owing to the fact
that a revolute joint has five constraints, and CType specifies that all
of these are Hard. This means that the kinematic solver is not allowed
to violate any of them.</p>
<p>If you similarly locate and unfold the C3DMotion object you again find a
CType, and double-clicking it reveals</p>
<div class="highlight-AnyScriptDoc"><div class="highlight"><pre><span></span><span class="n">CType</span> <span class="o">=</span> <span class="p">{</span><span class="kp">Soft</span><span class="p">,</span> <span class="kp">Soft</span><span class="p">,</span> <span class="kp">Soft</span><span class="p">}</span>
</pre></div>
</div>
<p>We have implicitly specified that the joint is a hard constraint while
the marker is a soft constraint. Joints automatically have their
constraint types set to Hard and AnyKinDriverMarker objects
automatically have soft constraints, but these rules can be overridden
by the user by explicit specification of CType in the respective
objects.</p>
<p>In <a class="reference internal" href="lesson3.html"><span class="doc">Lesson 3</span></a> we investigate how to filter noise out of
the measured data.</p>
<div class="without-title admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><strong>Next lesson:</strong> <a class="reference internal" href="lesson3.html"><span class="doc">Lesson3: Noise and filters</span></a>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
        <p class="logo"><a href="../index.html" title="index">
          <img class="logo" src="../_static/anybody_tutorials_logo.png" alt="Logo"/>
        </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
<div class="sphinx-toc sphinxglobaltoc">
<h3><a href="../contents.html">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Tutorial overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../A_Getting_started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../A_Getting_started_anyscript/index.html">Getting started: AnyScript Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="../A_Getting_started_modeling/index.html">Getting Started with Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Interface_features/index.html">User interface features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../A_study_of_studies/index.html">A Study of Studies</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Making things move</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson1.html">Lesson1: Simple drivers</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Lesson 2: Using motion capture data</a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson3.html">Lesson3: Noise and filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson4.html">Lesson 4: Parameter identification</a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson5.html">Lesson 5: Using real data</a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson6.html">Lesson 6: Weight functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson7.html">Lesson 7: Troubleshooting C3D files</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../MuscleRecruitment/index.html">Inverse Dynamics of Muscle Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ForceDependentKinematics/index.html">Force-Dependent Kinematics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Muscle_modeling/index.html">Muscle Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../The_mechanical_elements/index.html">The Mechanical Elements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Advanced_script_features/index.html">Advanced Script Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Finite_element_analysis/index.html">Finite Element Analysis Interfacing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AnyExp4SOLIDWORKS/index.html">Making Models using SOLIDWORKS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Scaling/index.html">Subject Specific Scaling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Validation_of_models/index.html">Validation of Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Parameter_studies_and_optimization/index.html">Parameter Studies and Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Troubleshooting_anyscript/intro.html">Trouble Shooting AnyScript Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Posture_and_movement/intro.html">Posture and Movement Prediction</a></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/Making_things_move/lesson2.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
    
    
        <div class="sidebar-toggle-group no-js">
            
            <button class="sidebar-toggle" id="sidebar-hide" title="Hide the sidebar menu">
                 «
                <span class="show-for-small">hide menu</span>
                
            </button>
            <button class="sidebar-toggle" id="sidebar-show" title="Show the sidebar menu">
                
                <span class="show-for-small">menu</span>
                <span class="hide-for-small">sidebar</span>
                 »
            </button>
        </div>
    
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../contents.html" title="Table Of Contents"
             >toc</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="lesson3.html" title="Lesson3: Noise and filters"
             >next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="lesson1.html" title="Lesson1: Simple drivers"
             >previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">AnyBody Tutorials v7.0.1.dev Documentation</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="index.html" >Making things move</a> &#187;</li> 
      </ul>
    </div>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, AnyBody Technology.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.4.
    </div>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>