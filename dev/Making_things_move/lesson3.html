


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Lesson3: Noise and filters &#8212; AnyBody Tutorials v7.0.1.dev Documentation</title>
    <link rel="stylesheet" href="../_static/cloud.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noticia+Text|Open+Sans|Droid+Sans+Mono" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '7.0.1.dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/jquery.cookie.js"></script>
    <script type="text/javascript" src="../_static/cloud.base.js"></script>
    <script type="text/javascript" src="../_static/cloud.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Lesson 4: Parameter identification" href="lesson4.html" />
    <link rel="prev" title="Lesson 2: Using motion capture data" href="lesson2.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <body>
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../contents.html" title="Table Of Contents"
             accesskey="C">toc</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="lesson4.html" title="Lesson 4: Parameter identification"
             accesskey="N">next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="lesson2.html" title="Lesson 2: Using motion capture data"
             accesskey="P">previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">AnyBody Tutorials v7.0.1.dev Documentation</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="intro.html" accesskey="U">Making things move</a> &#187;</li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="lesson3-noise-and-filters">
<h1>Lesson3: Noise and filters<a class="headerlink" href="#lesson3-noise-and-filters" title="Permalink to this headline">¶</a></h1>
<p>Let us run the Kinematics operation and investigate the results. After
the operation has completed, please click Window -&gt; CharFX 2D (New) and
plot the position vector of the pendulum as shown below:</p>
<p><a class="reference internal" href="../_images/image133.png"><img alt="pendulum.r" src="../_images/image133.png" style="width: 4.63542in; height: 3.12500in;" /></a></p>
<p>The red, green and blue curves designate x, y and z locations
respectively of the center of mass of the pendulum. We see the expected
sinusoidal curves for x and y and a z location that is constantly zero.
It all looks fine and dandy, but closer investigation will reveal that
it is not.</p>
<p>If we plot the velocity, <code class="docutils literal"><span class="pre">rDot</span></code>, rather than the position, we begin to see
the problem:</p>
<p><a class="reference internal" href="../_images/image227.png"><img alt="pendulum.rdot" src="../_images/image227.png" style="width: 3.55208in; height: 2.46875in;" /></a></p>
<p>It is obvious that the motion is not as smooth as we would expect from
the first set of graphs, and it gets even worse if we plot the
accelerations, <code class="docutils literal"><span class="pre">rDDot</span></code>:</p>
<p><a class="reference internal" href="../_images/image323.png"><img alt="pendulum.rddot" src="../_images/image323.png" style="width: 3.55208in; height: 2.46875in;" /></a></p>
<p>Since forces in a mechanical system stem from accelerations, an analysis
of the force in this system would lead to a completely different result
than we would expect. The problem is due to noise in the measurements,
and noise is always present in several different forms. Although it can
be minimized by careful experimental procedures and good equipment, it
can never be completely removed. Therefore, it is always necessary to
filter motion capture data before use.</p>
<p>The AnyInputC3D class has a default filter built in. It is a special
case of a more general filter class in AnyBody, and the special case is
a second-order, zero-phase Butterworth filter with a cutoff frequency of
10 Hz. If you do not specify anything else, then this is what you are
going to get. In this case, it is obviously not sufficient, so let’s
play a bit with the settings and see whether we can get better results.</p>
<p>The filter section of the AnyInputC3D section is currently inactive.
Please remove the <code class="docutils literal"><span class="pre">/*</span> <span class="pre">*/</span></code> surrounding the object, and you will have the
following:</p>
<div class="highlight-AnyScriptDoc"><div class="highlight"><pre><span></span><span class="n">Filter</span> <span class="o">=</span> <span class="p">{</span>
<span class="n">z0</span> <span class="o">=</span> <span class="p">;</span>
<span class="n">AutomaticInitialConditionOnOff</span> <span class="o">=</span> <span class="kp">On</span><span class="p">;</span>
<span class="n">FilterForwardBackwardOnOff</span> <span class="o">=</span> <span class="kp">On</span><span class="p">;</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="n">W</span> <span class="o">=</span> <span class="p">;</span>
<span class="n">Fs</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">Fc</span> <span class="o">=</span> <span class="p">{</span><span class="mi">10</span><span class="p">};</span>
<span class="n">Type</span> <span class="o">=</span> <span class="kp">LowPass</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The first two lines pertain to the filter’s initial condition, and z0
cannot be set when AutomaticInitialConditionOnOff is set to On, meaning
that the initial condition of the filter gets computed automatically.
The automatic computation is an attempt to minimize initial transients
in the signal, but it may not always be good enough, and in this case it
can be relevant to set the initial conditions. For now, let us keep the
automatic setting and therefore remove the incomplete line with z0:</p>
<div class="highlight-AnyScriptDoc"><div class="highlight"><pre><span></span><span class="n">Filter</span> <span class="o">=</span> <span class="p">{</span>
<span class="gr">// z0 = ;</span>
<span class="n">AutomaticInitialConditionOnOff</span> <span class="o">=</span> <span class="kp">On</span><span class="p">;</span>
<span class="n">FilterForwardBackwardOnOff</span> <span class="o">=</span> <span class="kp">On</span><span class="p">;</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="n">W</span> <span class="o">=</span> <span class="p">;</span>
<span class="n">Fs</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">Fc</span> <span class="o">=</span> <span class="p">{</span><span class="mi">10</span><span class="p">};</span>
<span class="n">Type</span> <span class="o">=</span> <span class="kp">LowPass</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The third line, FilterForwardBackwardOnOff, is mostly included for the
sake of completeness. When it is set to on, zero phase shift in the
filter is obtained by filtering twice, i.e. first forward and then
backward in the signal, which is the standard approach. Please leave it
as it is unless you really know what you are doing.</p>
<p>The property N is simply the order of the filter. The default value is 2
and higher values lead to sharper cuts at the specified cutoff
frequency.</p>
<p>W is the normalized cutoff frequency. Allowed values are between zero
and one with one corresponding to half of the sampling frequency.
However, it is not allowed to specify W when filtering data from a C3D
file because the file already contains information about the sampling
frequency, so you can safely delete this line.</p>
<p>Fs is the sampling frequency, and like W, we cannot specify it when
reading from a C3D file, so please remove this line.</p>
<p>Fc is the cutoff frequency and is set to 10 Hz by default. The dilemma
with filters is always that they can reduce noise and other undesirable
elements of the signal, but in the process they also may remove
desirable parts of the signal or even introduce artifacts. 10 Hz is a
relatively safe value for experiments with human motion, but it would
obviously not be a safe choice if we were modeling insect motion or
other phenomena with higher frequency content.</p>
<p>Finally, the last line specifies the type of the filter as low pass,
which is the relevant value for a signal like this, where the noise is
high frequency, but the filters in AnyBody also allow for other types.
Please refer to the reference manual for a complete description.</p>
<p>In the graph of Pendulum.r above, the red curve seems to have a
frequency of about 0.2 Hz and the green curve about 0.4 Hz. This is
safely below our present 10 Hz cutoff frequency, so there seems to be
room to eliminate more noise by using a lower value of Fc. If we change</p>
<div class="highlight-AnyScriptDoc"><div class="highlight"><pre><span></span><span class="n">Filter</span> <span class="o">=</span> <span class="p">{</span>
<span class="gr">// z0 = ;</span>
<span class="n">AutomaticInitialConditionOnOff</span> <span class="o">=</span> <span class="kp">On</span><span class="p">;</span>
<span class="n">FilterForwardBackwardOnOff</span> <span class="o">=</span> <span class="kp">On</span><span class="p">;</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="n">Fc</span> <span class="o">=</span> <span class="p">{</span><span class="gr">2</span><span class="p">};</span>
<span class="n">Type</span> <span class="o">=</span> <span class="kp">LowPass</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>…we can get the following accelerations:</p>
<p><a class="reference internal" href="../_images/image420.png"><img alt="pendulumfilt" src="../_images/image420.png" style="width: 3.94792in; height: 3.00000in;" /></a></p>
<p>They look much more reasonable, but notice that each end of the curve is
influenced by the initial conditions of the filter. Filters remove noise
but they are also sources of artifacts in the model and nothing is ever
completely perfect.</p>
<p>In this and the previous lesson we used the system’s ability to handle
over-constrained models to drive the pendulum with a marker that
supplies three constraints even though the pendulum only has one degree
of freedom. The additional information in the redundant constraints can
be used to our advantage for other purposes too, as we shall see in
<a class="reference internal" href="lesson4.html"><span class="doc">Lesson 4</span></a>.</p>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
        <p class="logo"><a href="../index.html" title="index">
          <img class="logo" src="../_static/anybody_tutorials_logo.png" alt="Logo"/>
        </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
<div class="sphinx-toc sphinxglobaltoc">
<h3><a href="../contents.html">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Tutorial overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../A_Getting_started/intro.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../A_Getting_started_AMMR/intro.html">Getting Started: The Model Repository</a></li>
<li class="toctree-l1"><a class="reference internal" href="../A_Getting_started_anyscript/intro.html">Getting started: AnyScript Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="../A_Getting_started_modeling/intro.html">Getting Started with Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Interface_features/intro.html">User interface features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../A_study_of_studies/intro.html">A Study of Studies</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="intro.html">Making things move</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="lesson1.html"> Lesson 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson2.html"> Lesson 2</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#"> Lesson 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson4.html"> Lesson 4</a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson5.html"> Lesson 5</a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson6.html"> Lesson 6</a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson7.html"> Lesson 7</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../MuscleRecruitment/Inverse_dynamics.html">Inverse Dynamics of Muscle Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ForceDependentKinematics/fdk.html">Force-Dependent Kinematics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Muscle_modeling/intro.html">Muscle Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../The_mechanical_elements/intro.html">The Mechanical Elements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Advanced_script_features/intro.html">Advanced Script Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Finite_element_analysis/intro.html">Finite Element Analysis Interfacing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AnyExp4SOLIDWORKS/intro.html">Making Models using SOLIDWORKS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Scaling/intro.html">Scaling</a></li>
</ul>
</div>
        </div>
      </div>
    
    
        <div class="sidebar-toggle-group no-js">
            
            <button class="sidebar-toggle" id="sidebar-hide" title="Hide the sidebar menu">
                 «
                <span class="show-for-small">hide menu</span>
                
            </button>
            <button class="sidebar-toggle" id="sidebar-show" title="Show the sidebar menu">
                
                <span class="show-for-small">menu</span>
                <span class="hide-for-small">sidebar</span>
                 »
            </button>
        </div>
    
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../contents.html" title="Table Of Contents"
             >toc</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="lesson4.html" title="Lesson 4: Parameter identification"
             >next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="lesson2.html" title="Lesson 2: Using motion capture data"
             >previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">AnyBody Tutorials v7.0.1.dev Documentation</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="intro.html" >Making things move</a> &#187;</li> 
      </ul>
    </div>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, AnyBody Technology.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.3.
    </div>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>