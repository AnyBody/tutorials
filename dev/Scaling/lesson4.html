
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<meta content="noindex" name="robots" />

<meta property="og:title" content="Lesson 2: Including a custom scaling function into your model" />
  
<meta property="og:type" content="website" />
  
<meta property="og:url" content="https://anyscript.org/Scaling/lesson4.html" />
  
<meta property="og:site_name" content="AnyScript Tutorials" />
  
<meta property="og:description" content="This lesson explains how we can use our own custom scaling function, which we designed in Lesson 3 and combine it with the overall human body scaling laws. Preparing for subject-specific scaling: W..." />
  
<meta property="og:image" content="https://anyscript.org/_images/image140.png" />
  
<meta property="og:image:alt" content="Scaling options in model tree" />
  
    <title>Lesson 2: Including a custom scaling function into your model &#8212; AnyBody Tutorials v7.4.0-dev</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=532d1baf3f03eb73f2f50828f8c27430120b156d"></script>
    <script src="../_static/design-tabs.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Posture and Movement Prediction" href="../Posture_and_movement/intro.html" />
    <link rel="prev" title="Appendix: Morphing based on landmarks" href="lesson3_appendix.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/AnyBodyTutorials2.svg" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../GettingStarted.html">
   <strong>
    Getting Started
   </strong>
  </a>
  <input checked class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../A_Getting_started/index.html">
     Getting Started - First steps
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started/intro.html">
       Getting Started Tutorial
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started/lesson1.html">
       Lesson 1: Creating a Standing Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started/lesson2.html">
       Lesson 2: Controlling the Posture
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started/lesson3.html">
       Lesson 3: Reviewing Analysis Results
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../A_Getting_started_anyscript/index.html">
     How to write AnyScript
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started_anyscript/intro.html">
       Introduction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started_anyscript/lesson1.html">
       Lesson 1: Basic Concepts
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started_anyscript/lesson2.html">
       Lesson 2: Defining Segments and Displaying Objects
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started_anyscript/lesson3.html">
       Lesson 3: Connecting Segments by Joints
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started_anyscript/lesson4.html">
       Lesson 4: Imparting movement with Drivers
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started_anyscript/lesson5.html">
       Lesson 5: Definition of Muscles and External Forces
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started_anyscript/lesson6.html">
       Lesson 6: Adding Real Bone Geometries
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../A_Getting_started_modeling/index.html">
     Modelling the Human body
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started_modeling/intro.html">
       Introduction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started_modeling/lesson1.html">
       Lesson 1: Starting with a New Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started_modeling/lesson2.html">
       Lesson 2: Adjusting the Human Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started_modeling/lesson3.html">
       Lesson 3: Making Ends Meet
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started_modeling/lesson4.html">
       Lesson 4: Kinetics - Computing Forces
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../A_Getting_started_AMMR/index.html">
     The AnyBody Model Repository
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
    <label for="toctree-checkbox-5">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference external" href="https://anyscript.org/ammr-doc/creating_model_from_scratch.html">
       Creating a Human Model from scratch
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference external" href="https://anyscript.org/ammr-doc/Scaling/lesson1.html">
       Scaling: Joint to joint scaling
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference external" href="https://anyscript.org/ammr-doc/Scaling/lesson2.html">
       Scaling: External Body Measurements
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference external" href="https://anyscript.org/ammr-doc/Scaling/lesson3.html">
       Scaling: Segmental scaling factors
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../Tutorials.html">
   <strong>
    Tutorials
   </strong>
  </a>
  <input checked class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../A_study_of_studies/index.html">
     A Study of Studies
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
    <label for="toctree-checkbox-7">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_study_of_studies/intro.html">
       Introduction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_study_of_studies/lesson1.html">
       Lesson1: Mechanical System Information
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_study_of_studies/lesson2.html">
       Lesson2: Initial Conditions
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_study_of_studies/lesson3.html">
       Lesson 3: Kinematic Analysis
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_study_of_studies/lesson4.html">
       Lesson 4: Inverse Dynamics
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../Making_things_move/index.html">
     Making things move
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
    <label for="toctree-checkbox-8">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../Making_things_move/intro.html">
       Introduction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Making_things_move/lesson1.html">
       Lesson1: Simple drivers
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Making_things_move/lesson2.html">
       Lesson 2: Using motion capture data
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Making_things_move/lesson3.html">
       Lesson3: Noise and filters
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Making_things_move/lesson4.html">
       Lesson 4: Parameter identification
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Making_things_move/lesson5.html">
       Lesson 5: Using real data
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Making_things_move/lesson6.html">
       Lesson 6: Troubleshooting C3D files
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../MuscleRecruitment/index.html">
     Inverse Dynamics of Muscle Systems
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
    <label for="toctree-checkbox-9">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../MuscleRecruitment/Inverse_dynamics.html">
       Introduction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../MuscleRecruitment/lesson1.html">
       Lesson 1: The Basics of Muscle Recruitment
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../MuscleRecruitment/lesson2.html">
       Lesson 2: Linear Muscle Recruitment
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../MuscleRecruitment/lesson3.html">
       Lesson 3: Quadratic Muscle Recruitment
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../MuscleRecruitment/lesson4.html">
       Lesson 4: Polynomial Muscle Recruitment
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../MuscleRecruitment/lesson5.html">
       Lesson 5: Min/Max Muscle Recruitment
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../MuscleRecruitment/lesson6.html">
       Lesson 6: Composite Recruitment Criteria
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../MuscleRecruitment/lesson_calibration.html">
       Lesson 7: Calibration
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../Muscle_modeling/index.html">
     Muscle Modeling
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
    <label for="toctree-checkbox-10">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../Muscle_modeling/intro.html">
       Introduction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Muscle_modeling/lesson1.html">
       Lesson 1: The Basics of Muscle Definition
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Muscle_modeling/lesson2.html">
       Lesson 2: Controlling Muscle Drawing
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Muscle_modeling/lesson3.html">
       Lesson 3: Via-point Muscles
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Muscle_modeling/lesson4.html">
       Lesson 4: Wrapping Muscles
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Muscle_modeling/lesson5.html">
       Lesson 5: Muscle Models
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Muscle_modeling/lesson6.html">
       Lesson 6: General Muscles
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Muscle_modeling/lesson7.html">
       Lesson 7: Ligaments
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../The_mechanical_elements/index.html">
     The Mechanical Elements
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
    <label for="toctree-checkbox-11">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../The_mechanical_elements/intro.html">
       Introduction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../The_mechanical_elements/lesson1.html">
       Lesson 1: Segments
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../The_mechanical_elements/lesson2.html">
       Lesson 2: Joints
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../The_mechanical_elements/lesson3.html">
       Lesson 3: Drivers
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../The_mechanical_elements/lesson4.html">
       Lesson 4: Kinematic Measures
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../The_mechanical_elements/lesson5.html">
       Lesson 5: Forces
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../ForceDependentKinematics/index.html">
     Force-Dependent Kinematics
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
    <label for="toctree-checkbox-12">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../ForceDependentKinematics/fdk.html">
       Introduction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../ForceDependentKinematics/lesson1.html">
       Lesson 1: The Baseline Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../ForceDependentKinematics/lesson2.html">
       Lesson 2: Adding FDK Features
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../ForceDependentKinematics/lesson3.html">
       Lesson 3: Results of FDK
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../ForceDependentKinematics/lesson4.html">
       Lesson 4: Using Surfaces to Define the Knee Joint
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../ForceDependentKinematics/lesson5.html">
       Lesson 5: Using Contact Forces to Replace a Joint in a Human Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../ForceDependentKinematics/fdkappendix.html">
       FDK appendix
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../Parameter_studies_and_optimization/index.html">
     Parameter Studies and Optimization
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
    <label for="toctree-checkbox-13">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../Parameter_studies_and_optimization/intro.html">
       Introduction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Parameter_studies_and_optimization/lesson1.html">
       Defining a Parameter Study
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Parameter_studies_and_optimization/lesson2.html">
       Optimization Studies
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Parameter_studies_and_optimization/lesson3.html">
       Optimization Studies in Python
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../Finite_element_analysis/index.html">
     Finite Element Analysis Interfacing
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
    <label for="toctree-checkbox-14">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../Finite_element_analysis/lesson1.html">
       Lesson 1: Export of data for FEA
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Finite_element_analysis/lesson2.html">
       Lesson 2: ANSYS Interface
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Finite_element_analysis/lesson3.html">
       Lesson 3: Abaqus Interface
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../AnyExp4SOLIDWORKS/index.html">
     Making Models using SOLIDWORKS
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
    <label for="toctree-checkbox-15">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../AnyExp4SOLIDWORKS/lesson1.html">
       Translating a SOLIDWORKS CAD model to AnyBody
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../AnyExp4SOLIDWORKS/lesson2.html">
       Making the translated AnyScript model move
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../AnyExp4SOLIDWORKS/lesson3.html">
       Creating human-machine integrated analysis model
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="index.html">
     Scaling and Personalizing your model
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
    <label for="toctree-checkbox-16">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="lesson3.html">
       Lesson 1: Scaling based on medical images
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
      <label for="toctree-checkbox-17">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="lesson3_appendix.html">
         Lesson 1 appendix
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 current active">
      <a class="current reference internal" href="#">
       Lesson 2: Including a custom scaling function into your model
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Posture_and_movement/intro.html">
     Posture and Movement Prediction
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../Interface_features/index.html">
     User interface features
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/>
    <label for="toctree-checkbox-18">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../Interface_features/intro.html">
       Introduction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Interface_features/lesson1.html">
       Lesson 1: The Editor Window
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Interface_features/lesson2.html">
       Lesson 2: The Model View Window
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Interface_features/lesson3.html">
       Lesson 3: The Chart View
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Interface_features/lesson4.html">
       Lesson 4: The Model Tree and Object Description
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Interface_features/lesson5.html">
       Lesson 5: The Command Line Application
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Interface_features/lesson6.html">
       Lesson 6: Modifying the Loaded Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Interface_features/lesson7.html">
       Lesson 7: Wrapping the Model with AnyBody Project
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../Advanced_script_features/index.html">
     Advanced Script Features
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/>
    <label for="toctree-checkbox-19">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../Advanced_script_features/lesson1.html">
       Lesson 1: Using References
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Advanced_script_features/lesson2.html">
       Lesson 2: Using Include Files
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Advanced_script_features/lesson3.html">
       Lesson 3: Mathematical Expressions
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Troubleshooting_anyscript/intro.html">
     Trouble Shooting AnyScript Models
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../Validation_of_models/index.html">
     Validation of Models
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/>
    <label for="toctree-checkbox-20">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../Validation_of_models/intro.html">
       Introduction to validation
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Validation_of_models/Kinematic_input.html">
       Validating Kinematic input
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../about.html">
   <strong>
    About
   </strong>
  </a>
  <input checked class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/>
  <label for="toctree-checkbox-21">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../contributing.html">
     Help improve tutorials
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../legal.html">
     Legal, Trademarks and Copyrights
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Tutorials by <a href="https://anybodytech.com">AnyBody Technology</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/anybody/anybody-tutorial/issues/new?title=Issue%20on%20page%20%2FScaling/lesson4.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/anybody/anybody-tutorial/edit/master/Scaling/lesson4.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#preparing-for-subject-specific-scaling">
   Preparing for subject-specific scaling
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#including-custom-scaling-for-a-single-segment">
   Including custom scaling for a single segment
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introducing-a-mirrored-custom-scaling-function">
   Introducing a mirrored custom scaling function
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Lesson 2: Including a custom scaling function into your model</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#preparing-for-subject-specific-scaling">
   Preparing for subject-specific scaling
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#including-custom-scaling-for-a-single-segment">
   Including custom scaling for a single segment
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introducing-a-mirrored-custom-scaling-function">
   Introducing a mirrored custom scaling function
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="lesson-2-including-a-custom-scaling-function-into-your-model">
<h1>Lesson 2: Including a custom scaling function into your model<a class="headerlink" href="#lesson-2-including-a-custom-scaling-function-into-your-model" title="Permalink to this headline">#</a></h1>
<p>This lesson explains how we can use our own custom scaling function,
which we designed in Lesson 3 and combine it with the overall human body scaling laws.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>The section on scaling in the AMMR documentation.</p>
</div>
<section id="preparing-for-subject-specific-scaling">
<h2>Preparing for subject-specific scaling<a class="headerlink" href="#preparing-for-subject-specific-scaling" title="Permalink to this headline">#</a></h2>
<p>When creating a musculoskeletal model, we have to decide on the
dimensions of the body parts. The Scaling section in the AMMR
documentation describes how anthropometric regression equations
and body measurements can be used to define these dimensions.
However, the most precise models include subject-specific geometries
of the bones or morph the underlying template model to take these shapes.
To explain how we can include these, let us consider a simple scenario:
We have a model of a person who matches the standard size man and we want
to perform an inverse dynamics analysis. Additionally, we have the geometry
from a CT-scan of one of his left femur. To increase the accuracy of our model,
let us improve it using a subject-specific scaling for the femur.</p>
<p>First of all, let us prepare a model matching the standard size man to
be the basis for further subject-specific improvements. Therefore we use the <a class="reference external" href="https://anyscript.org/ammr-doc/beta/auto_examples/Other/plot_StandingModelScalingDisplay.html#sphx-glr-auto-examples-other-plot-standingmodelscalingdisplay-py" title="(in AMMR v2.4)"><span class="xref myst">StandingModelScalingDisplay</span></a> from the AnyBody Managed Model Repository (AMMR), with the <code class="docutils literal notranslate"><span class="pre">_SCALING_STANDARD_</span></code>, option. This is well suited to show how
to use subject-specific geometry in a model.</p>
</section>
<section id="including-custom-scaling-for-a-single-segment">
<h2>Including custom scaling for a single segment<a class="headerlink" href="#including-custom-scaling-for-a-single-segment" title="Permalink to this headline">#</a></h2>
<p>Let us configure this example to use ScalingStandard. We need to define
<code class="docutils literal notranslate"><span class="pre">BM_SCALING</span></code> as <code class="docutils literal notranslate"><span class="pre">_SCALING_STANDARD_</span></code> and out-comment all other parts of
the scaling configuration block. With this setting, the model is now scaled to
the generic size.</p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span><span class="cm">/*------------- SCALING CONFIGURATION SECTION --------------------*/</span>
<span class="c1">// Actual scaling law</span>
<span class="gr"> #define BM_SCALING _SCALING_STANDARD_</span>

<span class="c1">// Scaling laws using joint to joint measures</span>
<span class="c1">//  #define BM_SCALING _SCALING_UNIFORM_</span>
<span class="c1">//  #define BM_SCALING _SCALING_LENGTHMASS_</span>
<span class="c1">//  #define BM_SCALING _SCALING_LENGTHMASS_FAT_</span>
</pre></div>
</div>
<p>We can now include individual scaling functions for each segment,
which will be done in a special file <code class="file docutils literal notranslate"><span class="pre">CustomScaling.any</span></code>, where all the
modifications related to individual segment should be be done.
This file is already present in the example and you can include it as shown
below:</p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span><span class="c1">//--------------- END OF SCALING CONFIGURATION -------------------</span>

<span class="gr">#include &quot;Model\CustomScaling.any&quot;</span>

<span class="cp">#include</span> <span class="s">&quot;&lt;ANYBODY_PATH_BODY&gt;/HumanModel.any&quot;</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>In case you want to personalize your own model - just copy <code class="file docutils literal notranslate"><span class="pre">CustomScaling.any</span></code>
file into the Model folder and follow the instructions from this tutorial.</p>
</div>
<p>If we open this file (by a double click it), we can see that a common place
to make modifications has already been prepared. Further, we can find
an access point to the geometrical scaling law folder, which will be
used to specify individual scaling laws.</p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span><span class="c1">// This is a place holder for the inclusion of custom scaling laws</span>
<span class="n">HumanModel</span><span class="p">.</span><span class="n">Scaling</span><span class="p">.</span><span class="n">GeometricalScaling</span> <span class="o">=</span> <span class="p">{</span>
<span class="p">};</span>
</pre></div>
</div>
<p>So let us introduce a custom scaling function for the left femur from
<a class="reference internal" href="lesson3.html"><span class="doc">Lesson 1</span></a>. We prepared a single file
<a class="reference download internal" download="" href="../_downloads/739b486f881de09cf787add525ceefca/MyScalingFunction.any"><code class="xref download docutils literal notranslate"><span class="pre">MyScalingFunction.any</span></code></a> holding the scaling
transforms from the previous lesson. We also need to download the
<a class="reference download internal" download="" href="../_downloads/c8a8d2f50b63c7f3c655ee62792be7e1/SourceFemur.stl"><code class="xref download docutils literal notranslate"><span class="pre">source</span></code></a> (native to AMMR) and
<a class="reference download internal" download="" href="../_downloads/535fa9251f95bad18235c0b6645bf786/TargetFemur.stl"><code class="xref download docutils literal notranslate"><span class="pre">target</span></code></a> (courtesy of Prof.
Sebastian Dendorfer, OTH Regensburg, Germany) femur surface
geometries.</p>
<p>Next copy these three files into the <code class="file docutils literal notranslate"><span class="pre">Model</span></code> subfolder in  the
<em>StandingModelScalingDisplay</em> example.</p>
<p>Now, we need to make several
small adjustments to the scaling law for smooth incorporation into the
model structure.</p>
<p>In the <strong>A</strong>nyBody <strong>M</strong>anaged <strong>M</strong>odel <strong>R</strong>epository (AMMR) scaling functions are
implemented in the anatomical reference frames. We will call this frame
a scaling reference frame, since there might be several definitions of
anatomical reference frames. In general, the segmental frame can be
different from the scaling reference frame. The human body model
internally handles relevant reference frame changes without needing
users to do anything. However, this leads to small modifications
needed for the subject-specific scaling function inclusion into
the full-body model.</p>
<p>In order to perform the scaling or moprhing in another reference frame – all source
entities need to be moved into that reference frame. This can be done
using a rigid body transformation to preserve sizes of all objects.
In our scaling law (MyScalingFunction.any) the source entities are</p>
<ul class="simple">
<li><p>MyScalingFunction.AffineTransform.Points0,</p></li>
<li><p>MyScalingFunction.RBFTransform.Points0,</p></li>
<li><p>MyScalingFunction.STLTransform.Input.SourceSurf.</p></li>
</ul>
<p>In the <strong>AMMR</strong> such transformations will be segment dependent.  It is only be needed for right and left shank and femur as well as for
the pelvis. For all other segments this transform can be defined as an
identity transformation or does not have to be applied to the source
entities. The following transforms can be referenced as <code class="docutils literal notranslate"><span class="pre">TSeg2ScaleFrame</span></code> (<strong>T</strong>ransform <strong>Seg</strong>mental <strong>2</strong> to <strong>Scale</strong>ling <strong>Frame</strong>). That name that will be used further:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">HumanModel.BodyModel.[Left/Right].Seg.[Thigh/Shank].Scale.T0</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HumanModel.BodyModel.Trunk.SegmentsLumbar.PelvisSeg.Scale_Trunk_Pelvis.ScaleAfterInterfaceMorphingDef.Scale.T0</span></code></p></li>
</ul>
<p>In the model repository this transform, <code class="docutils literal notranslate"><span class="pre">TSeg2ScaleFrame</span></code>, is already defined and can be found in the
subfolder of <code class="docutils literal notranslate"><span class="pre">HumanModel.Scaling.GeometricalScaling</span></code>, which corresponds to
the morphed segment and has a similar name. This transform can be easily
accessed as demonstrated below and no extra actions are needed.</p>
<p>Let us subject the source entities of the scaling law to the rigid body
transformation, <code class="docutils literal notranslate"><span class="pre">TSeg2ScaleFrame</span></code>. We will need to make the following 3
changes. Please note how we look up out of the <code class="docutils literal notranslate"><span class="pre">MyScalingFunction</span></code> folder
using <code class="docutils literal notranslate"><span class="pre">..</span></code> and <code class="docutils literal notranslate"><span class="pre">...</span></code> prefixes to the variables.:</p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span>  <span class="kt">AnyFunTransform3DLin2</span> <span class="n">AffineTransform</span> <span class="o">=</span>
  <span class="p">{</span>
    <span class="n">Points0</span> <span class="o">=</span> <span class="gr">..TSeg2ScaleFrame(</span>
    <span class="p">{{</span><span class="mf">0.0138187</span><span class="p">,</span><span class="mf">0.00136731</span><span class="p">,</span><span class="mf">0.0273618</span><span class="p">},</span>    <span class="c1">// fovea capitis</span>
<span class="o">--&gt;</span><span class="mi">8</span><span class="o">--</span>
      <span class="p">{</span><span class="mf">0.0368766</span><span class="p">,</span><span class="o">-</span><span class="mf">0.393677</span><span class="p">,</span><span class="mf">0.0266919</span><span class="p">}}</span><span class="gr">)</span><span class="p">;</span>    <span class="c1">// medial posterior condyle</span>
    <span class="n">Points1</span> <span class="o">=</span>
    <span class="p">{{</span><span class="mf">0.289913</span><span class="p">,</span><span class="mf">0.420538</span><span class="p">,</span><span class="mf">0.0138931</span><span class="p">},</span>    <span class="c1">// fovea capitis</span>
<span class="o">--&gt;</span><span class="mi">8</span><span class="o">--</span>
  <span class="kt">AnyFunTransform3DRBF</span> <span class="n">RBFTransform</span> <span class="o">=</span>
  <span class="p">{</span>
    <span class="n">PreTransforms</span> <span class="o">=</span> <span class="p">{</span><span class="o">&amp;</span><span class="p">.</span><span class="n">AffineTransform</span><span class="p">};</span>
    <span class="n">RBFDef</span> <span class="o">=</span>
    <span class="p">{</span>
      <span class="n">Type</span> <span class="o">=</span> <span class="kp">RBF_ThinPlate</span><span class="p">;</span>
      <span class="n">Param</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="n">Points0</span> <span class="o">=</span> <span class="gr">..TSeg2ScaleFrame(</span><span class="p">{</span>
      <span class="p">{</span> <span class="mf">0.0138</span><span class="p">,</span> <span class="mf">0.0014</span><span class="p">,</span> <span class="mf">0.0274</span><span class="p">},</span>
<span class="o">--&gt;</span><span class="mi">8</span><span class="o">--</span>
      <span class="p">{</span> <span class="mf">0.0010</span><span class="p">,</span> <span class="mf">0.0013</span><span class="p">,</span> <span class="mf">0.0069</span><span class="p">}</span>
    <span class="p">}</span><span class="gr">)</span><span class="p">;</span>
<span class="o">--&gt;</span><span class="mi">8</span><span class="o">--</span>
  <span class="kt">AnyFunTransform3DSTL</span> <span class="n">STLTransform</span> <span class="o">=</span>
  <span class="p">{</span>
    <span class="n">PreTransforms</span> <span class="o">=</span> <span class="p">{</span><span class="o">&amp;</span><span class="p">.</span><span class="n">RBFTransform</span><span class="p">};</span>
    <span class="n">RBFDef</span><span class="p">.</span><span class="n">Type</span> <span class="o">=</span> <span class="kp">RBF_ThinPlate</span><span class="p">;</span>
    <span class="kt">AnyFixedRefFrame</span> <span class="n">Input</span> <span class="o">=</span> <span class="p">{</span>
      <span class="kt">AnySurfSTL</span> <span class="n">SourceSurf</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">FileName</span> <span class="o">=</span> <span class="s">&quot;SourceFemur.stl&quot;</span><span class="p">;</span>
        <span class="n">ScaleXYZ</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">};</span>
        <span class="gr">AnyFunTransform3D &amp;pre = ....TSeg2ScaleFrame; </span>
      <span class="p">};</span>
</pre></div>
</div>
<p>As you will see from the following changes the modification simply links
the transformations to the folder containing our <code class="docutils literal notranslate"><span class="pre">MyScalingFunction.any</span></code> file.
In our case, this folder is
<code class="docutils literal notranslate"><span class="pre">HumanModel.Scaling.GeometricalScaling.Left.Thigh</span></code>, which corresponds to
the name of the segment, we are trying to morph, and contains our
<code class="docutils literal notranslate"><span class="pre">TSeg2ScaleFrame</span></code> rigid body transform.</p>
<p>So finally let us add this scaling function to the model. Please
insert the following lines as shown below into the file
<code class="file docutils literal notranslate"><span class="pre">CustomScaling.any</span></code>:</p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span><span class="n">HumanModel</span><span class="p">.</span><span class="n">Scaling</span><span class="p">.</span><span class="n">GeometricalScaling</span> <span class="o">=</span> <span class="p">{</span>
<span class="gr">#define CUSTOM_SCALING_Left_Thigh</span>
<span class="gr">Left.Thigh = {</span>
<span class="gr">  #include &quot;MyScalingFunction.any&quot;</span>
<span class="gr">  AnyFunTransform3D &amp;ScaleFunction = MyScalingFunction.Transform;</span>
<span class="gr">};</span>
<span class="p">};</span>
</pre></div>
</div>
<p>In this modification, we added a pre-processor command (<code class="docutils literal notranslate"><span class="pre">#define</span></code>) that
notifies the model assembling block that the default anthropometric scaling
for the left thigh segment should be excluded. To process other body
parts you will need to add a similar definition, but utilize actual
bone segment, e.g. <code class="docutils literal notranslate"><span class="pre">#define</span> <span class="pre">CUSTOM_SCALING_&lt;Side&gt;_&lt;SegmentName&gt;</span></code> for
different sides or <code class="docutils literal notranslate"><span class="pre">CUSTOM_SCALING_&lt;SegmentName&gt;</span></code> for parts of the
body that do not have sides. You can find a list of segments by
browsing the scaling law in the Model tab:</p>
<img alt="Scaling options in model tree" src="../_images/image140.png" />
<p>The other change was to assign the new custom scaling function to be
used in the segment of the left thigh instead of the excluded one. If
we look in the Model View,
we can see that the left femur is now shorter and a little thinner
than with the standard scaling. So we have now successfully introduced
our custom scaling law into the model.</p>
<a class="reference internal image-reference" href="../_images/image233.png"><img alt="Scaling options in model tree" src="../_images/image233.png" style="width: 60%;" /></a>
<p>If we worked with a bone that does not have a controlateral pair, e.g.
vertebrae, skull, etc., or just wanted to personalize a single side, we would
continue with running the inverse dynamics. But as an exercise, we want to
continue and scale the other side as well to ensure symmetry of the model.
Normally, we would use the contralateral patient-specific bone and
copy the scaling code. But, in our case, only one side was available. We will assume
that the body is symmetric, which is only true up to a certain extent.
So let us include a similar scaling for the corresponding mirrored pair.
In the next section we will describe how to introduce mirroring to our
scaling functions.</p>
</section>
<section id="introducing-a-mirrored-custom-scaling-function">
<h2>Introducing a mirrored custom scaling function<a class="headerlink" href="#introducing-a-mirrored-custom-scaling-function" title="Permalink to this headline">#</a></h2>
<p>We start by making a copy of MyScalingFunction.any that will be used to
construct the mirrored transform and call it <code class="docutils literal notranslate"><span class="pre">MyScalingFunction_Mirrored.any</span></code>.
What we have to do is to define a symmetry plane and reflect relevant
entities accordingly. In this example such plane corresponds to the
global XY plane. To perform the reflection, we need to multiply all
relevant landmark points contained in the <code class="docutils literal notranslate"><span class="pre">MyScalingFunction_Mirrored.any</span></code>
file by a mirroring matrix:</p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span><span class="kt">AnyFolder</span> <span class="n">MyScalingFunction</span><span class="gr">_Mirrored</span> <span class="o">=</span> <span class="p">{</span>
  <span class="gr">AnyMatrix AMirroring = { // XY plane symmetry</span>
<span class="gr">    {1,0,0},</span>
<span class="gr">    {0,1,0},</span>
<span class="gr">    {0,0,-1}</span>
<span class="gr">  };</span>
<span class="o">--&gt;</span><span class="mi">8</span><span class="o">--</span>
  <span class="kt">AnyFunTransform3DLin2</span> <span class="n">AffineTransform</span> <span class="o">=</span>
  <span class="p">{</span>
    <span class="n">Points0</span> <span class="o">=</span> <span class="p">..</span><span class="n">TSeg2ScaleFrame</span><span class="p">({...}</span> <span class="gr">* .AMirroring</span><span class="p">);</span>
    <span class="n">Points1</span> <span class="o">=</span> <span class="p">{...}</span> <span class="gr">* .AMirroring</span><span class="p">;</span>
    <span class="n">Mode</span> <span class="o">=</span> <span class="kp">VTK_LANDMARK_AFFINE</span><span class="p">;</span>
  <span class="p">};</span>
<span class="o">--&gt;</span><span class="mi">8</span><span class="o">--</span>
  <span class="kt">AnyFunTransform3DRBF</span> <span class="n">RBFTransform</span> <span class="o">=</span>
  <span class="p">{</span>
    <span class="o">--&gt;</span><span class="mi">8</span><span class="o">--</span>
    <span class="n">Points0</span> <span class="o">=</span> <span class="p">..</span><span class="n">TSeg2ScaleFrame</span><span class="p">({...}</span> <span class="gr">* .AMirroring</span><span class="p">);</span>
    <span class="n">Points1</span> <span class="o">=</span> <span class="p">{...}</span> <span class="gr">* .AMirroring</span><span class="p">;</span>
    <span class="o">--&gt;</span><span class="mi">8</span><span class="o">--</span>
  <span class="p">};</span>
<span class="p">};</span>  <span class="c1">// MyScalingFunction§_Mirrored§</span>
</pre></div>
</div>
<p>After mirroring the landmarks, we have to think about the surfaces
which were also used in the construction of this transform. So we have
to reflect them too. This can be done easily by just changing the
ScaleXYZ members of the input surfaces of the AnyFunTransform3DSTL
class:</p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span><span class="kt">AnyFolder</span> <span class="n">MyScalingFunction_Mirrored</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="kt">AnyFunTransform3DSTL</span> <span class="n">STLTransform</span> <span class="o">=</span>
  <span class="p">{</span>
    <span class="n">PreTransforms</span> <span class="o">=</span> <span class="p">{</span><span class="o">&amp;</span><span class="p">.</span><span class="n">RBFTransform</span><span class="p">};</span>
    <span class="n">PolynomDegree</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">RBFDef</span><span class="p">.</span><span class="n">Type</span> <span class="o">=</span> <span class="kp">RBF_Triharmonic</span><span class="p">;</span>
    <span class="kt">AnyFixedRefFrame</span> <span class="n">Input</span> <span class="o">=</span> <span class="p">{</span>
      <span class="kt">AnySurfSTL</span> <span class="n">SourceSurf</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">FileName</span> <span class="o">=</span> <span class="s">&quot;SourceFemur.stl&quot;</span><span class="p">;</span>
        <span class="n">ScaleXYZ</span> <span class="o">=</span> <span class="gr">{1, 1, -1}</span><span class="p">;</span>
        <span class="kt">AnyFunTransform3D</span> <span class="o">&amp;</span><span class="n">pre</span> <span class="o">=</span> <span class="p">....</span><span class="n">TSeg2ScaleFrame</span><span class="p">;</span>
      <span class="p">};</span>
      <span class="kt">AnySurfSTL</span> <span class="n">TargetSurf</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">FileName</span> <span class="o">=</span> <span class="s">&quot;TargetFemur.stl&quot;</span><span class="p">;</span>
        <span class="n">ScaleXYZ</span> <span class="o">=</span> <span class="gr">{1, 1, -1}</span><span class="p">;</span>
      <span class="p">};</span>
    <span class="p">};</span>

    <span class="n">SurfaceObjects0</span> <span class="o">=</span> <span class="p">{</span><span class="o">&amp;</span><span class="n">Input</span><span class="p">.</span><span class="n">SourceSurf</span><span class="p">};</span>
    <span class="n">SurfaceObjects1</span> <span class="o">=</span> <span class="p">{</span><span class="o">&amp;</span><span class="n">Input</span><span class="p">.</span><span class="n">TargetSurf</span><span class="p">};</span>
    <span class="c1">//FileName0 = &quot;SourceFemur.stl&quot;;    // such definition was used previously</span>
    <span class="c1">//FileName1 = &quot;TargetFemur.stl&quot;;    // such definition was used previously</span>
    <span class="n">NumPoints</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
    <span class="n">BoundingBox</span><span class="p">.</span><span class="n">ScaleXYZ</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">};</span>
    <span class="n">BoundingBox</span><span class="p">.</span><span class="n">DivisionFactorXYZ</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">};</span>
    <span class="n">BoundingBoxOnOff</span> <span class="o">=</span> <span class="kp">On</span><span class="p">;</span>
  <span class="p">};</span>
  <span class="p">...</span>
<span class="p">};</span>  <span class="c1">// MyScalingFunction_Mirrored</span>
</pre></div>
</div>
<p>Finally, we have to include the mirrored scaling into the model exactly
the same way the left thigh scaling was included:</p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span><span class="cp">#define</span> <span class="n">CUSTOM_SCALING_Left_Thigh</span>
<span class="gr">#define CUSTOM_SCALING_Right_Thigh</span>
<span class="n">Left</span><span class="p">.</span><span class="n">Thigh</span> <span class="o">=</span> <span class="p">{</span>
  <span class="cp">#include</span> <span class="s">&quot;MyScalingFunction.any&quot;</span>
  <span class="kt">AnyFunTransform3D</span> <span class="o">&amp;</span><span class="n">ScaleFunction</span> <span class="o">=</span> <span class="n">MyScalingFunction</span><span class="p">.</span><span class="n">Transform</span><span class="p">;</span>
<span class="p">};</span>
<span class="gr"> Right.Thigh = {</span>
<span class="gr">  #include &quot;MyScalingFunction_Mirrored.any&quot;</span>
<span class="gr">  AnyFunTransform3D &amp;ScaleFunction = MyScalingFunction_Mirrored.Transform;</span>
<span class="gr">};</span>
</pre></div>
</div>
<p>Now the right and left thigh are morphed using the custom scaling functions.
When we load the model and look at our Model View, we can see that the model
looks symmetric again and, compared to the standard scaling model, the bones
look smaller. We can also see this in the following image where the model
changed from the standard scaling case (left) to the custom scaling one (right):</p>
<a class="reference internal image-reference" href="../_images/image332.png"><img alt="../_images/image332.png" src="../_images/image332.png" style="width: 100%;" /></a>
<p>This concludes the subject-specific scaling tutorial. The modifications
utilized for the mirrored transformed model can be downloaded from here:
<a class="reference download internal" download="" href="../_downloads/79a11bba1b858f4f0891909e65b7004c/MyScalingFunction_Mirrored.final.any"><code class="xref download docutils literal notranslate"><span class="pre">Downloads/MyScalingFunction_Mirrored.final.any</span></code></a></p>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="lesson3_appendix.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Appendix: Morphing based on landmarks</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../Posture_and_movement/intro.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Posture and Movement Prediction</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By AnyBody Technology<br/>
  
      &copy; Copyright 2022, AnyBody Technology.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>