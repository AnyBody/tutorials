


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta content="noindex" name="robots" />

    <title>Lesson 6: General Muscles &#8212; AnyBody Tutorials v7.1.0.dev</title>
    <link rel="stylesheet" href="../_static/cloud.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noticia+Text|Open+Sans|Droid+Sans+Mono" type="text/css" />
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/jquery.cookie.js"></script>
    <script type="text/javascript" src="../_static/cloud.base.js"></script>
    <script type="text/javascript" src="../_static/cloud.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Lesson 7: Ligaments" href="lesson7.html" />
    <link rel="prev" title="Lesson 5: Muscle Models" href="lesson5.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
  </head><body>
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../contents.html" title="Table Of Contents"
             accesskey="C">toc</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="lesson7.html" title="Lesson 7: Ligaments"
             accesskey="N">next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="lesson5.html" title="Lesson 5: Muscle Models"
             accesskey="P">previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">AnyBody Tutorials v7.1.0.dev</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">10. Muscle Modeling</a> &#187;</li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="lesson-6-general-muscles">
<h1>Lesson 6: General Muscles<a class="headerlink" href="#lesson-6-general-muscles" title="Permalink to this headline">¶</a></h1>
<p>Physiological muscles are truly amazing machines, and despite many
attempts it has not been possible to make technical actuators that are
as light and efficient as natural muscles. As you may have seen in the
preceding sections, the mathematical modeling of muscles is not&nbsp;an easy
task&nbsp;either. But once it has been done, we can use some of the
properties of muscles to our advantage. We would like these “muscles” to
be able to have a slightly more general formulation than physiological
muscles, which are confined to acting along strings.</p>
<p>The solution is the AnyGeneralMuscle class. This type of muscle is
capable of acting on <em>Kinematic Measures</em>. <em>Kinematic Measures</em> is an
abstract class representing anything you can measure on a model, and
there is in fact <a class="reference internal" href="../The_mechanical_elements/lesson4.html"><span class="doc">an entire tutorial lesson devoted to the
subject</span></a> in the
section on <a class="reference internal" href="../The_mechanical_elements/intro.html"><span class="doc">The Mechanical
Elements</span></a>. Some
examples are:</p>
<ul class="simple">
<li>A general muscle working on a distance measure between two points
becomes simply a linear force provider, or in fact a reaction
provider in the sense that the force is not predetermined but will
become whatever equilibrium requires.</li>
<li>A general muscle working on an angular measure, for instance a joint
angle, becomes a torque provider.</li>
<li>A general muscle working on a Center of Mass measure becomes an
abstract force working on all segments of the body contributing to
the center of mass.</li>
</ul>
<p>This lesson demonstrates how general muscles can be used for a variety
of modeling tasks.</p>
<div class="section" id="muscles-as-joint-torque-providers">
<h2>Muscles as joint torque providers<a class="headerlink" href="#muscles-as-joint-torque-providers" title="Permalink to this headline">¶</a></h2>
<p>One of the purposes of the AnyBody Modeling System is to be able to
model the musculoskeletal system&nbsp;to a realistic level of detail.
However, there is a place in the world for traditional inverse dynamics,
where the muscles are disregarded and the body is balanced entirely by
joint torques. This type of analysis can provide important information
about the function of limbs and joints, and it is extremely numerically
efficient.</p>
<p>Joint torque inverse dynamics can&nbsp;be accomplished by adding general
muscles to the joints to replace the physiological muscles of the body.
This way, the “muscle forces” computed in the general muscles will
simply be the joint torques.</p>
<p>The example from the preceding lessons is not well suited to play with joint
torques, so please <a class="reference download internal" href="../_downloads/MuscleDemo.6.any" download=""><code class="xref download docutils literal"><span class="pre">download a new example to start on.</span></code></a>&nbsp;This is in fact a simplified version of the simple
arm example from the <em>Getting Started with AnyScript</em> tutorial, where the
muscles have been removed. The model has two segments, an upper arm and a
forearm,&nbsp;and is attached to the global reference frame at the shoulder. It has a
100 N vertical load acting downwards at the hand.</p>
<p><img alt="Arm 2D" src="../_images/image18.jpeg" /></p>
<p>The lack of muscles means that the model cannot currently do an inverse
dynamics analysis. If you try to run the&nbsp;InverseDynamics operation, you will get the following error message:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>NOTICE(OBJ1): MuscleDemo.6.any(103): ArmStudy.InverseDynamics: No muscles in the model.
ERROR(OBJ1): MuscleDemo.6.any(103): ArmStudy.InverseDynamics: No solution found: There are fewer unknown forces (muscles and reactions) than dynamic equations.
</pre></div>
</div>
<p>which is a mathematical way of stating that the model cannot be balanced
in the absence of muscles. In this case we are not going to add real
muscles. Instead we shall add general muscles to the revolute joints.
The best way to introduce a general muscle is to insert it from the
class tree. Place the cursor after the Drivers folder, locate the
AnyGeneralMuscle in the class tree, and insert a template:</p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span>  <span class="kt">AnyFolder</span> <span class="n">Drivers</span> <span class="o">=</span> <span class="p">{</span>

   <span class="c1">//---------------------------------</span>
   <span class="kt">AnyKinEqSimpleDriver</span> <span class="n">ShoulderMotion</span> <span class="o">=</span> <span class="p">{</span>
     <span class="kt">AnyRevoluteJoint</span> <span class="o">&amp;</span><span class="n">Jnt</span> <span class="o">=</span> <span class="p">..</span><span class="n">Jnts</span><span class="p">.</span><span class="n">Shoulder</span><span class="p">;</span>
     <span class="n">DriverPos</span> <span class="o">=</span> <span class="p">{</span><span class="o">-</span><span class="mf">1.7</span><span class="p">};</span>
     <span class="n">DriverVel</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.4</span><span class="p">};</span>
     <span class="n">Reaction</span><span class="p">.</span><span class="n">Type</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
   <span class="p">};</span> <span class="c1">// Shoulder driver</span>

   <span class="c1">//---------------------------------</span>
   <span class="kt">AnyKinEqSimpleDriver</span> <span class="n">ElbowMotion</span> <span class="o">=</span> <span class="p">{</span>
     <span class="kt">AnyRevoluteJoint</span> <span class="o">&amp;</span><span class="n">Jnt</span> <span class="o">=</span> <span class="p">..</span><span class="n">Jnts</span><span class="p">.</span><span class="n">Elbow</span><span class="p">;</span>
     <span class="n">DriverPos</span> <span class="o">=</span> <span class="p">{</span><span class="mf">1.5</span><span class="p">};</span>
     <span class="n">DriverVel</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.7</span><span class="p">};</span>
     <span class="n">Reaction</span><span class="p">.</span><span class="n">Type</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
   <span class="p">};</span> <span class="c1">// Elbow driver</span>
 <span class="p">};</span> <span class="c1">// Driver folder</span>

<span class="gr">AnyGeneralMuscle &lt;ObjectName&gt; = {</span>
<span class="gr">   //ForceDirection = -1;</span>
<span class="gr">   AnyKinMeasure &amp;&lt;Insert name0&gt; = &lt;Insert object reference (or full object definition)&gt;;</span>
<span class="gr">   AnyMuscleModel &amp;&lt;Insert name0&gt; = &lt;Insert object reference (or full object definition)&gt;;</span>
<span class="gr"> };</span>
</pre></div>
</div>
<p>Just as normal muscles, general muscles must be associated with a muscle
model. Let us insert a simple one:</p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span><span class="gr">AnyMuscleModel &lt;ObjectName&gt; = {</span>
<span class="gr">   F0 = 0;</span>
<span class="gr">   //Lf0 = 0;</span>
<span class="gr">   //Vol0 = 0;</span>
<span class="gr"> };</span>

<span class="kt">AnyGeneralMuscle</span> <span class="o">&lt;</span><span class="n">ObjectName</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">{</span>
   <span class="c1">//ForceDirection = -1.000000;</span>
   <span class="kt">AnyKinMeasure</span> <span class="o">&amp;&lt;</span><span class="n">Insert</span> <span class="n">name0</span><span class="o">&gt;</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">Insert</span> <span class="n">object</span> <span class="n">reference</span> <span class="p">(</span><span class="n">or</span> <span class="n">full</span> <span class="n">object</span> <span class="n">definition</span><span class="p">)</span><span class="o">&gt;</span><span class="p">;</span>
   <span class="kt">AnyMuscleModel</span> <span class="o">&amp;&lt;</span><span class="n">Insert</span> <span class="n">name0</span><span class="o">&gt;</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">Insert</span> <span class="n">object</span> <span class="n">reference</span> <span class="p">(</span><span class="n">or</span> <span class="n">full</span> <span class="n">object</span> <span class="n">definition</span><span class="p">)</span><span class="o">&gt;</span><span class="p">;</span>
 <span class="p">};</span>
</pre></div>
</div>
<p>The empty fields in the muscle model must be filled in:</p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span><span class="kt">AnyMuscleModel</span> <span class="gr">MusModel</span> <span class="o">=</span> <span class="p">{</span>
    <span class="gr">F0 = 100.0;</span>
  <span class="p">};</span>
</pre></div>
</div>
<p>Note that the simple muscle model class has the optional memebers (parameters) of Lf0 and Vol0 that are usually left out for use with AnyGeneralMuscle.</p>
<p>We shall associate the muscle with the shoulder joint:</p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span><span class="kt">AnyMuscleModel</span> <span class="n">MusModel</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">F0</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="kt">AnyGeneralMuscle</span> <span class="gr">ShoulderTorque</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1">//ForceDirection = -1;</span>
    <span class="kt">AnyKinMeasure</span> <span class="o">&amp;</span><span class="gr">Angle = .Jnts.Shoulder</span><span class="p">;</span>
    <span class="kt">AnyMuscleModel</span> <span class="o">&amp;</span><span class="gr">Model = .MusModel</span><span class="p">;</span>
  <span class="p">};</span>
</pre></div>
</div>
<p>Providing a torque for the shoulder is not enough. We also need a torque
in the elbow:</p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span> <span class="kt">AnyGeneralMuscle</span> <span class="n">ShoulderTorque</span> <span class="o">=</span> <span class="p">{</span>
   <span class="c1">//ForceDirection = -1;</span>
   <span class="kt">AnyKinMeasure</span> <span class="o">&amp;</span><span class="n">Angle</span> <span class="o">=</span> <span class="p">.</span><span class="n">Jnts</span><span class="p">.</span><span class="n">Shoulder</span><span class="p">;</span>
   <span class="kt">AnyMuscleModel</span> <span class="o">&amp;</span><span class="n">Model</span> <span class="o">=</span> <span class="p">.</span><span class="n">MusModel</span><span class="p">;</span>
 <span class="p">};</span>

<span class="gr">AnyGeneralMuscle ElbowTorque = {</span>
<span class="gr">   //ForceDirection = -1;</span>
<span class="gr">   AnyKinMeasure &amp;Angle = .Jnts.Elbow;</span>
<span class="gr">   AnyMuscleModel &amp;Model = .MusModel;</span>
<span class="gr"> };</span>
</pre></div>
</div>
<p>Having provided torques for the shoulder and elbow it should be possible
to run the inverse dynamic analysis. However, attempting to do so will
provide the same depressing error message as before. The reason is that
general muscles share the ability to be unilateral with normal muscles.
The direction of action is controlled by the variable ForceDirection. If
the muscle acts in the positive direction of the joint angle, then it
direction should be set = 1, and if it is in the negative joint angle
direction it should be -1. In the present case the external load tends
to work in the negative angle direction for the shoulder as well as the
elbow, and hence the muscles should counteract in the positive
direction:</p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span> <span class="kt">AnyGeneralMuscle</span> <span class="n">ShoulderTorque</span> <span class="o">=</span> <span class="p">{</span>
  <span class="gr">ForceDirection = 1</span><span class="p">;</span>
   <span class="kt">AnyKinMeasure</span> <span class="o">&amp;</span><span class="n">Angle</span> <span class="o">=</span> <span class="p">.</span><span class="n">Jnts</span><span class="p">.</span><span class="n">Shoulder</span><span class="p">;</span>
   <span class="kt">AnyMuscleModel</span> <span class="o">&amp;</span><span class="n">Model</span> <span class="o">=</span> <span class="p">.</span><span class="n">MusModel</span><span class="p">;</span>
 <span class="p">};</span>

<span class="kt">AnyGeneralMuscle</span> <span class="n">ElbowTorque</span> <span class="o">=</span> <span class="p">{</span>
  <span class="gr">ForceDirection = 1</span><span class="p">;</span>
   <span class="kt">AnyKinMeasure</span> <span class="o">&amp;</span><span class="n">Angle</span> <span class="o">=</span> <span class="p">.</span><span class="n">Jnts</span><span class="p">.</span><span class="n">Elbow</span><span class="p">;</span>
   <span class="kt">AnyMuscleModel</span> <span class="o">&amp;</span><span class="n">Model</span> <span class="o">=</span> <span class="p">.</span><span class="n">MusModel</span><span class="p">;</span>
 <span class="p">};</span>
</pre></div>
</div>
<p>Now the InverseDynamics operation can be run. Having done so, we can
open a new Chart View and look up the two joint torques as the Fm
property of the general muscles. We can plot both of them simultaneously
using an asterix as shown below:</p>
<p><img alt="Chart view, Torques" src="../_images/image23.gif" /></p>
<p>Notice that in this case we have used the same strength (muscle model)
for both joints. However, the maximum joint torque in physiological
joints varies a lot. The knee extension strength, for instance is
significantly larger than the elbow extension strength. If you perform
this type of modeling you can define joint torque muscles with strengths
comparable to the available joint torque and the system can give you an
estimate of how many percent of each joint’s strength is used in a given
situation. You can also define different strengths of extension and
flexion muscles in a given joint and thereby take for instance the
difference in strength in the knee in these two directions into account.</p>
<p><code class="docutils literal highlight highlight-AnyScriptDoc"><span></span><span class="n">Important</span> <span class="n">Remark</span>:</code> Another useful property of the general muscles used as joint torque
providers is that you can handle <strong>closed loops</strong> and other statically
indeterminate situations, which are not treatable by traditional inverse
dynamics because the equilibrium equations do not have a unique
solution. The muscle recruitment algorithm will then distribute the load
between joints according to their individual strengths, and it is
therefore important to have reasonable estimates of joint strengths for
this type of situation.</p>
</div>
<div class="section" id="contact-and-other-boundary-conditions">
<h2>Contact and other boundary conditions<a class="headerlink" href="#contact-and-other-boundary-conditions" title="Permalink to this headline">¶</a></h2>
<p>One of the characteristics of muscles is that they are unilateral, i.e.
they can only exert force in one direction. Mathematically this behavior
creates a significant amount of problems, but many mechanical phenomena
have the same characteristics, namely any kind of contact phenomenon.
Biomechanics is full of contact problems:</p>
<ul class="simple">
<li>The contact between a foot and the floor</li>
<li>The contact between&nbsp;the upper thighs&nbsp;and the seat of a chair</li>
<li>The contact between two articulating surfaces in a joint.</li>
</ul>
<p>There is another less appreciated similarity between muscle forces and
contact forces: neither is without limit. Muscle forces are obviously
limited by the strength of the muscle. Contact forces to the environment
may seem like they are only limited by the strength of whatever is
supporting the body, but it can also be limited by friction and by the
pressure on the contacting tissues; if you have a stone in one shoe you
will very likely put less weight on that foot than on the other.</p>
<p>So the muscles of the body in addition to creating equilibrium are
constrained by the available contact forces to the environment, and
these often have different limits in different directions, typically a
high limit in compression perpendicularly against the supporting
surface, a smaller limit for friction tangentially to the surface, and
no reaction available in tension. Mathematically and mechanically this
is very much how muscles work, and the conditions therefore affect the
mechanics of the entire system much like muscles do and can be mimicked
by means of general muscles.</p>
<p><img alt="Simple arm wall" src="../_images/image34.jpeg" /></p>
<p>We are going to make a couple of changes to the simple arm model to
investigate contact in more detail. We shall imagine that the hand of
the model has a vertical wall to support against. We have to change the
kinematics to make the arm slide along the wall. It would be really
difficult to figure out which joint angle variations are needed to make
the hand move vertically, so we drive the hand directly instead.</p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span> <span class="kt">AnyFolder</span> <span class="n">Jnts</span> <span class="o">=</span> <span class="p">{</span>

   <span class="c1">//---------------------------------</span>
   <span class="kt">AnyRevoluteJoint</span> <span class="n">Shoulder</span> <span class="o">=</span> <span class="p">{</span>
     <span class="n">Axis</span> <span class="o">=</span> <span class="kp">z</span><span class="p">;</span>
     <span class="kt">AnyRefNode</span> <span class="o">&amp;</span><span class="n">GroundNode</span> <span class="o">=</span> <span class="p">..</span><span class="n">GlobalRef</span><span class="p">.</span><span class="n">Shoulder</span><span class="p">;</span>
     <span class="kt">AnyRefNode</span> <span class="o">&amp;</span><span class="n">UpperArmNode</span> <span class="o">=</span> <span class="p">..</span><span class="n">Segs</span><span class="p">.</span><span class="n">UpperArm</span><span class="p">.</span><span class="n">ShoulderNode</span><span class="p">;</span>
   <span class="p">};</span> <span class="c1">// Shoulder joint</span>

   <span class="kt">AnyRevoluteJoint</span> <span class="n">Elbow</span> <span class="o">=</span> <span class="p">{</span>
     <span class="n">Axis</span> <span class="o">=</span> <span class="kp">z</span><span class="p">;</span>
     <span class="kt">AnyRefNode</span> <span class="o">&amp;</span><span class="n">UpperArmNode</span> <span class="o">=</span> <span class="p">..</span><span class="n">Segs</span><span class="p">.</span><span class="n">UpperArm</span><span class="p">.</span><span class="n">ElbowNode</span><span class="p">;</span>
     <span class="kt">AnyRefNode</span> <span class="o">&amp;</span><span class="n">LowerArmNode</span> <span class="o">=</span> <span class="p">..</span><span class="n">Segs</span><span class="p">.</span><span class="n">LowerArm</span><span class="p">.</span><span class="n">ElbowNode</span><span class="p">;</span>
   <span class="p">};</span> <span class="c1">// Elbow joint</span>

 <span class="p">};</span> <span class="c1">// Jnts folder</span>

<span class="gr">AnyKinLinear HandPos = {</span>
<span class="gr">   AnyRefFrame &amp;ref1 = .GlobalRef.Shoulder;</span>
<span class="gr">   AnyRefFrame &amp;ref2 = .Segs.LowerArm.PalmNode;</span>
<span class="gr"> };</span>

 <span class="kt">AnyFolder</span> <span class="n">Drivers</span> <span class="o">=</span> <span class="p">{</span>
  <span class="gr">AnyKinEqSimpleDriver HandDriver = {</span>
<span class="gr">     AnyKinLinear &amp;Measure = ..HandPos;</span>
<span class="gr">     MeasureOrganizer = {0,1};</span>
<span class="gr">     DriverPos = {0.45, -0.6};</span>
<span class="gr">     DriverVel = {0, 0.5};</span>
<span class="gr">     Reaction.Type = {0, 0};</span>
<span class="gr">   };</span>

 <span class="gr"> /*</span>
   <span class="c1">//---------------------------------</span>
   <span class="kt">AnyKinEqSimpleDriver</span> <span class="n">ShoulderMotion</span> <span class="o">=</span> <span class="p">{</span>
      <span class="kt">AnyRevoluteJoint</span> <span class="o">&amp;</span><span class="n">Jnt</span> <span class="o">=</span> <span class="p">..</span><span class="n">Jnts</span><span class="p">.</span><span class="n">Shoulder</span><span class="p">;</span>
      <span class="n">DriverPos</span> <span class="o">=</span> <span class="p">{</span><span class="o">-</span><span class="mf">1.7</span><span class="p">};</span>
      <span class="n">DriverVel</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.4</span><span class="p">};</span>
      <span class="n">Reaction</span><span class="p">.</span><span class="n">Type</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
   <span class="p">};</span> <span class="c1">// Shoulder driver</span>

   <span class="c1">//---------------------------------</span>
   <span class="kt">AnyKinEqSimpleDriver</span> <span class="n">ElbowMotion</span> <span class="o">=</span> <span class="p">{</span>
      <span class="kt">AnyRevoluteJoint</span> <span class="o">&amp;</span><span class="n">Jnt</span> <span class="o">=</span> <span class="p">..</span><span class="n">Jnts</span><span class="p">.</span><span class="n">Elbow</span><span class="p">;</span>
      <span class="n">DriverPos</span> <span class="o">=</span> <span class="p">{</span><span class="mf">1.5</span><span class="p">};</span>
      <span class="n">DriverVel</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.7</span><span class="p">};</span>
      <span class="n">Reaction</span><span class="p">.</span><span class="n">Type</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
   <span class="p">};</span> <span class="c1">// Elbow driver</span>

 <span class="gr">*/</span>

 <span class="p">};</span> <span class="c1">// Driver folder</span>
</pre></div>
</div>
<p>Notice that the previous two joint angle drivers have been disabled.
Otherwise the system would become kinematically over-determinate. Notice
also that the new driver drives two degrees of freedom corresponding
exactly to the two drivers we have disabled. Finally, please notice the
line</p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span><span class="n">Reaction</span><span class="p">.</span><span class="n">Type</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">};</span>
</pre></div>
</div>
<p>which means that the wall presently provides no reaction forces to the
arm. Plotting the MaxMuscleActivity provides the following result:</p>
<p><img alt="no reaction MaxMuscleActivity plot" src="../_images/image41.gif" /></p>
<p>The muscle activity is rather constant which is the natural consequence
of the moment arms being rather constant. The gravity as well as the
applied load of 100 N are vertical, so one might be tempted to think
that a horizontal support would not make much of a difference. We can do
a quick test by simply switching on the horizontal support of the
driver:</p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span><span class="n">Reaction</span><span class="p">.</span><span class="n">Type</span> <span class="o">=</span> <span class="p">{</span><span class="gr">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">};</span>
</pre></div>
</div>
<p>This produces immediate proof that mechanics is usually more complicated
than expected; even this very simple mechanical system behaves
differently from what we might expect:</p>
<p><img alt="Full reaction MaxMuscleActivity plot" src="../_images/image51.gif" /></p>
<p>Notice that the muscle activity is much smaller in the beginning of the
movement with the reaction switched on and much the same towards the end
of the movement. It seems like the muscles are able to use the
horizontal reaction force to their advantage depending on the posture of
the mechanism.</p>
<p>Walls in general do not work like that; they can only provide reaction
pressure but no tension. This we can mimic with general a muscle. We
first switch the reaction off again:</p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span><span class="n">Reaction</span><span class="p">.</span><span class="n">Type</span> <span class="o">=</span> <span class="p">{</span><span class="gr">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">};</span>
</pre></div>
</div>
<p>Subsequently we define a general muscle:</p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span> <span class="kt">AnyMuscleModel</span> <span class="n">MusModel</span> <span class="o">=</span> <span class="p">{</span>
   <span class="n">F0</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
 <span class="p">};</span>

<span class="gr">AnyMuscleModel ReacModel = {</span>
<span class="gr">   F0 = 10000.0;</span>
<span class="gr"> };</span>

<span class="gr"> AnyGeneralMuscle WallReaction = {</span>
<span class="gr">   ForceDirection = -1;</span>
<span class="gr">   AnyKinMeasureOrg Org = {</span>
<span class="gr">     AnyKinMeasure &amp;wall = ..HandPos;</span>
<span class="gr">     MeasureOrganizer = {0};</span>
<span class="gr">   };</span>
<span class="gr">   AnyMuscleModel &amp;Model = .ReacModel;</span>
<span class="gr"> };</span>
</pre></div>
</div>
<p>There are two things to notice here</p>
<ol class="arabic simple">
<li>The muscle model for the reaction, ReacModel, is much stronger than
the joint muscles. This is because the wall is presumed to be very
strong.</li>
<li>The ForceDirection property equals -1. This means that the force is
working in the opposite direction of the Kinematic measure, i.e. in
the negative global x direction, just like&nbsp;a contact force with the
wall would do.</li>
</ol>
<p>Running the InverseDynamics operation again and plotting the two joint
torques provides the following graph (notice they can be plotted
simultaneously with the specification line
<code class="docutils literal highlight highlight-AnyScriptDoc"><span></span><span class="n">Main</span><span class="p">.</span><span class="n">ArmStudy</span><span class="p">.</span><span class="n">Output</span><span class="p">.</span><span class="n">Model</span><span class="p">.</span><span class="o">*</span><span class="n">Torque</span><span class="p">.</span><span class="n">Fm</span></code>):</p>
<p><img alt="Joint torques plot" src="../_images/image61.gif" /></p>
<p>The red curve is the shoulder joint torque, and the green curve is the
elbow torque. Notice that the envelope of these two curves is in fact
identical to the MaxMuscleActivity curve we plotted above for the case
of no support. You would think that the support would be beneficial in
the final stages of the movement where the arm could rest a bit against
the wall. Actually, it&nbsp;is beneficial for the elbow, but the reaction
force also increases the torque about the shoulder, and since the
shoulder (red curve) has the higher load of the two, this limits the
benefit of the support. Let us see what happens if we turn the reaction
force the other way like if the hand could pull against the far side of
the wall:</p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span><span class="kt">AnyGeneralMuscle</span> <span class="n">WallReaction</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">ForceDirection</span> <span class="o">=</span> <span class="gr">1</span><span class="p">;</span>
  <span class="kt">AnyKinMeasureOrg</span> <span class="n">Org</span> <span class="o">=</span> <span class="p">{</span>
    <span class="kt">AnyKinMeasure</span> <span class="o">&amp;</span><span class="n">wall</span> <span class="o">=</span> <span class="p">..</span><span class="n">HandPos</span><span class="p">;</span>
    <span class="n">MeasureOrganizer</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
  <span class="p">};</span>
  <span class="kt">AnyMuscleModel</span> <span class="o">&amp;</span><span class="n">Model</span> <span class="o">=</span> <span class="p">.</span><span class="n">ReacModel</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>If you run the model again and plot the same graphs, you will see this:</p>
<p><img alt="Joint torques plot 2" src="../_images/image7.gif" /></p>
<p>The wall is obviously useful in the initial stages of the movement where
the torque generated by the reaction force is in the beneficial
direction for both joints. In the later stages of the movement the
presence of the wall decreases the envelope of the muscle forces
slightly, but it has increased the torque in the elbow. The explanation
is that the elbow can increase its action beyond what is necessary to
carry the load and generate an additional pressure against the wall,
which then decreases the torque in the shoulder.</p>
<p>This example shows how complicated the mechanics of the body is. Even
this very simplified case would have different solutions if the
parameters of the model were different. For instance if the shoulder
were much stronger compared to the elbow, then the elbow would not have
been able to help&nbsp;the shoulder&nbsp;in the latter case because the elbow
would have the higher load compared to its strength. On the contrary,
the shoulder would have been able to help the elbow in the former case
by generating an additional force pushing against the wall.</p>
<p>This completes the part of this tutorial dealing with muscles. But we
are not completely finished yet. The <a class="reference internal" href="lesson7.html"><span class="doc">next lesson</span></a>
deals with the important topic of ligament modeling.</p>
<div class="without-title admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><strong>Next lesson:</strong> <a class="reference internal" href="lesson7.html"><span class="doc">Lesson 7: Ligaments</span></a>.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
        <p class="logo"><a href="../index.html" title="index">
          <img class="logo" src="../_static/anybody_tutorials_logo.png" alt="Logo"/>
        </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
<div class="sphinx-toc sphinxglobaltoc">
<h3><a href="../contents.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Tutorial overview</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../A_Getting_started/index.html">1. Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../A_Getting_started_anyscript/index.html">2. Getting started: AnyScript Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="../A_Getting_started_modeling/index.html">3. Getting Started with Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../A_Getting_started_AMMR/index.html">4. Getting started: The Model Repository</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Interface_features/index.html">5. User interface features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../A_study_of_studies/index.html">6. A Study of Studies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Making_things_move/index.html">7. Making things move</a></li>
<li class="toctree-l1"><a class="reference internal" href="../MuscleRecruitment/index.html">8. Inverse Dynamics of Muscle Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ForceDependentKinematics/index.html">9. Force-Dependent Kinematics</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">10. Muscle Modeling</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson1.html">Lesson 1: The Basics of Muscle Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson2.html">Lesson 2: Controlling Muscle Drawing</a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson3.html">Lesson 3: Via-point Muscles</a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson4.html">Lesson 4: Wrapping Muscles</a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson5.html">Lesson 5: Muscle Models</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Lesson 6: General Muscles</a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson7.html">Lesson 7: Ligaments</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../The_mechanical_elements/index.html">11. The Mechanical Elements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Advanced_script_features/index.html">12. Advanced Script Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Finite_element_analysis/index.html">13. Finite Element Analysis Interfacing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AnyExp4SOLIDWORKS/index.html">14. Making Models using SOLIDWORKS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Scaling/index.html">15. Personalizing Your Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Validation_of_models/index.html">16. Validation of Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Parameter_studies_and_optimization/index.html">17. Parameter Studies and Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Troubleshooting_anyscript/intro.html">18. Trouble Shooting AnyScript Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Posture_and_movement/intro.html">19. Posture and Movement Prediction</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../legal.html">Legal, Trademarks and Copyrights</a></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/Muscle_modeling/lesson6.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
    
    
        <div class="sidebar-toggle-group no-js">
            
            <button class="sidebar-toggle" id="sidebar-hide" title="Hide the sidebar menu">
                 «
                <span class="show-for-small">hide menu</span>
                
            </button>
            <button class="sidebar-toggle" id="sidebar-show" title="Show the sidebar menu">
                
                <span class="show-for-small">menu</span>
                <span class="hide-for-small">sidebar</span>
                 »
            </button>
        </div>
    
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../contents.html" title="Table Of Contents"
             >toc</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="lesson7.html" title="Lesson 7: Ligaments"
             >next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="lesson5.html" title="Lesson 5: Muscle Models"
             >previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">AnyBody Tutorials v7.1.0.dev</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="index.html" >10. Muscle Modeling</a> &#187;</li> 
      </ul>
    </div>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, AnyBody Technology.
    </div>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>