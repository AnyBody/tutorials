
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<meta content="noindex" name="robots" />

<meta property="og:title" content="Lesson 2: Adding FDK Features" />
  
<meta property="og:type" content="website" />
  
<meta property="og:url" content="https://anyscript.org/ForceDependentKinematics/lesson2.html" />
  
<meta property="og:site_name" content="AnyScript Tutorials" />
  
<meta property="og:description" content="What we have now is a standard inverse dynamics AnyBody model capable of computing forces in a knee joint that is presumed to be a simple hinge. Real knees are unfortunately not as simple as that. ..." />
  
<meta property="og:image" content="https://anyscript.org/tutorials/_static/anybody_tutorials_logo.png" />
  
<meta property="og:image:alt" content="AnyScript Tutorials" />
  
    <title>Lesson 2: Adding FDK Features &#8212; AnyBody Tutorials v7.4.0-dev</title>
  <script>
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=9b1a4fa89bdd0e95b23b" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=9b1a4fa89bdd0e95b23b" rel="stylesheet">

  
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/6.1.2/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=6aa211a80e8e0ad13c9f98b61f85fb78546ea56f" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=9b1a4fa89bdd0e95b23b">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=4f5a1d078b6c00e5ef435388cc61494d2f099c28"></script>
    <script src="../_static/design-tabs.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'ForceDependentKinematics/lesson2';</script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Lesson 3: Results of FDK" href="lesson3.html" />
    <link rel="prev" title="Lesson 1: The Baseline Model" href="lesson1.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">

  
  <input type="checkbox" class="sidebar-toggle" name="__primary" id="__primary">
  <label class="overlay overlay-primary" for="__primary"></label>

  
  <input type="checkbox" class="sidebar-toggle" name="__secondary" id="__secondary">
  <label class="overlay overlay-secondary" for="__secondary"></label>

  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
      
<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
  </div>

  


  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        


    <div class="bd-sidebar__content">
        <div class="sidebar-start-items"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/AnyBodyTutorials2.svg" class="logo" alt="logo">
      
      
    </a>
</div>
<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../GettingStarted.html">
   <strong>
    Getting Started
   </strong>
  </a>
  <input checked class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label class="toctree-toggle" for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../A_Getting_started/index.html">
     Getting Started - First steps
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label class="toctree-toggle" for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started/intro.html">
       Getting Started Tutorial
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started/lesson1.html">
       Lesson 1: Creating a Standing Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started/lesson2.html">
       Lesson 2: Controlling the Posture
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started/lesson3.html">
       Lesson 3: Reviewing Analysis Results
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../A_Getting_started_anyscript/index.html">
     How to write AnyScript
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label class="toctree-toggle" for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started_anyscript/intro.html">
       Introduction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started_anyscript/lesson1.html">
       Lesson 1: Basic Concepts
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started_anyscript/lesson2.html">
       Lesson 2: Defining Segments and Displaying Objects
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started_anyscript/lesson3.html">
       Lesson 3: Connecting Segments by Joints
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started_anyscript/lesson4.html">
       Lesson 4: Imparting movement with Drivers
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started_anyscript/lesson5.html">
       Lesson 5: Definition of Muscles and External Forces
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started_anyscript/lesson6.html">
       Lesson 6: Adding Real Bone Geometries
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../A_Getting_started_modeling/index.html">
     Modelling the Human body
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label class="toctree-toggle" for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started_modeling/intro.html">
       Introduction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started_modeling/lesson1.html">
       Lesson 1: Starting with a New Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started_modeling/lesson2.html">
       Lesson 2: Adjusting the Human Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started_modeling/lesson3.html">
       Lesson 3: Making Ends Meet
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_Getting_started_modeling/lesson4.html">
       Lesson 4: Kinetics - Computing Forces
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../A_Getting_started_AMMR/index.html">
     The AnyBody Model Repository
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
    <label class="toctree-toggle" for="toctree-checkbox-5">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference external" href="https://anyscript.org/ammr-doc/creating_model_from_scratch.html">
       Creating a Human Model from scratch
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference external" href="https://anyscript.org/ammr-doc/Scaling/lesson1.html">
       Scaling: Joint to joint scaling
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference external" href="https://anyscript.org/ammr-doc/Scaling/lesson2.html">
       Scaling: External Body Measurements
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference external" href="https://anyscript.org/ammr-doc/Scaling/lesson3.html">
       Scaling: Segmental scaling factors
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../Tutorials.html">
   <strong>
    Tutorials
   </strong>
  </a>
  <input checked class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label class="toctree-toggle" for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../A_study_of_studies/index.html">
     A Study of Studies
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
    <label class="toctree-toggle" for="toctree-checkbox-7">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_study_of_studies/intro.html">
       Introduction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_study_of_studies/lesson1.html">
       Lesson1: Mechanical System Information
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_study_of_studies/lesson2.html">
       Lesson2: Initial Conditions
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_study_of_studies/lesson3.html">
       Lesson 3: Kinematic Analysis
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../A_study_of_studies/lesson4.html">
       Lesson 4: Inverse Dynamics
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../Making_things_move/index.html">
     Making things move
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
    <label class="toctree-toggle" for="toctree-checkbox-8">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../Making_things_move/intro.html">
       Introduction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Making_things_move/lesson1.html">
       Lesson1: Simple drivers
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Making_things_move/lesson2.html">
       Lesson 2: Using motion capture data
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Making_things_move/lesson3.html">
       Lesson3: Noise and filters
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Making_things_move/lesson4.html">
       Lesson 4: Parameter identification
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Making_things_move/lesson5.html">
       Lesson 5: Using real data
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Making_things_move/lesson6.html">
       Lesson 6: Troubleshooting C3D files
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../MuscleRecruitment/index.html">
     Inverse Dynamics of Muscle Systems
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
    <label class="toctree-toggle" for="toctree-checkbox-9">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../MuscleRecruitment/Inverse_dynamics.html">
       Introduction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../MuscleRecruitment/lesson1.html">
       Lesson 1: The Basics of Muscle Recruitment
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../MuscleRecruitment/lesson2.html">
       Lesson 2: Linear Muscle Recruitment
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../MuscleRecruitment/lesson3.html">
       Lesson 3: Quadratic Muscle Recruitment
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../MuscleRecruitment/lesson4.html">
       Lesson 4: Polynomial Muscle Recruitment
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../MuscleRecruitment/lesson5.html">
       Lesson 5: Min/Max Muscle Recruitment
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../MuscleRecruitment/lesson6.html">
       Lesson 6: Composite Recruitment Criteria
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../MuscleRecruitment/lesson_calibration.html">
       Lesson 7: Calibration
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../Muscle_modeling/index.html">
     Muscle Modeling
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
    <label class="toctree-toggle" for="toctree-checkbox-10">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../Muscle_modeling/intro.html">
       Introduction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Muscle_modeling/lesson1.html">
       Lesson 1: The Basics of Muscle Definition
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Muscle_modeling/lesson2.html">
       Lesson 2: Controlling Muscle Drawing
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Muscle_modeling/lesson3.html">
       Lesson 3: Via-point Muscles
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Muscle_modeling/lesson4.html">
       Lesson 4: Wrapping Muscles
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Muscle_modeling/lesson5.html">
       Lesson 5: Muscle Models
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Muscle_modeling/lesson6.html">
       Lesson 6: General Muscles
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Muscle_modeling/lesson7.html">
       Lesson 7: Ligaments
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../The_mechanical_elements/index.html">
     The Mechanical Elements
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
    <label class="toctree-toggle" for="toctree-checkbox-11">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../The_mechanical_elements/intro.html">
       Introduction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../The_mechanical_elements/lesson1.html">
       Lesson 1: Segments
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../The_mechanical_elements/lesson2.html">
       Lesson 2: Joints
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../The_mechanical_elements/lesson3.html">
       Lesson 3: Drivers
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../The_mechanical_elements/lesson4.html">
       Lesson 4: Kinematic Measures
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../The_mechanical_elements/lesson5.html">
       Lesson 5: Forces
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="index.html">
     Force-Dependent Kinematics
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
    <label class="toctree-toggle" for="toctree-checkbox-12">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3">
      <a class="reference internal" href="fdk.html">
       Introduction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="lesson1.html">
       Lesson 1: The Baseline Model
      </a>
     </li>
     <li class="toctree-l3 current active">
      <a class="current reference internal" href="#">
       Lesson 2: Adding FDK Features
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="lesson3.html">
       Lesson 3: Results of FDK
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="lesson4.html">
       Lesson 4: Using Surfaces to Define the Knee Joint
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="lesson5.html">
       Lesson 5: Using Contact Forces to Replace a Joint in a Human Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="fdkappendix.html">
       FDK appendix
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../Parameter_studies_and_optimization/index.html">
     Parameter Studies and Optimization
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
    <label class="toctree-toggle" for="toctree-checkbox-13">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../Parameter_studies_and_optimization/intro.html">
       Introduction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Parameter_studies_and_optimization/lesson1.html">
       Defining a Parameter Study
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Parameter_studies_and_optimization/lesson2.html">
       Optimization Studies
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Parameter_studies_and_optimization/lesson3.html">
       Optimization Studies in Python
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../Finite_element_analysis/index.html">
     Finite Element Analysis Interfacing
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
    <label class="toctree-toggle" for="toctree-checkbox-14">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../Finite_element_analysis/lesson1.html">
       Lesson 1: Export of data for FEA
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Finite_element_analysis/lesson2.html">
       Lesson 2: ANSYS Interface
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Finite_element_analysis/lesson3.html">
       Lesson 3: Abaqus Interface
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../AnyExp4SOLIDWORKS/index.html">
     Making Models using SOLIDWORKS
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
    <label class="toctree-toggle" for="toctree-checkbox-15">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../AnyExp4SOLIDWORKS/lesson1.html">
       Translating a SOLIDWORKS CAD model to AnyBody
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../AnyExp4SOLIDWORKS/lesson2.html">
       Making the translated AnyScript model move
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../AnyExp4SOLIDWORKS/lesson3.html">
       Creating human-machine integrated analysis model
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../Scaling/index.html">
     Scaling and Personalizing your model
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
    <label class="toctree-toggle" for="toctree-checkbox-16">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../Scaling/lesson3.html">
       Lesson 1: Scaling based on medical images
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
      <label class="toctree-toggle" for="toctree-checkbox-17">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../Scaling/lesson3_appendix.html">
         Lesson 1 appendix
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Scaling/lesson4.html">
       Lesson 2: Including a custom scaling function into your model
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Posture_and_movement/intro.html">
     Posture and Movement Prediction
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../Interface_features/index.html">
     User interface features
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/>
    <label class="toctree-toggle" for="toctree-checkbox-18">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../Interface_features/intro.html">
       Introduction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Interface_features/lesson1.html">
       Lesson 1: The Editor Window
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Interface_features/lesson2.html">
       Lesson 2: The Model View Window
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Interface_features/lesson3.html">
       Lesson 3: The Chart View
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Interface_features/lesson4.html">
       Lesson 4: The Model Tree and Object Description
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Interface_features/lesson5.html">
       Lesson 5: The Command Line Application
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Interface_features/lesson6.html">
       Lesson 6: Modifying the Loaded Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Interface_features/lesson7.html">
       Lesson 7: Wrapping the Model with AnyBody Project
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../Advanced_script_features/index.html">
     Advanced Script Features
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/>
    <label class="toctree-toggle" for="toctree-checkbox-19">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../Advanced_script_features/lesson1.html">
       Lesson 1: Using References
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Advanced_script_features/lesson2.html">
       Lesson 2: Using Include Files
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Advanced_script_features/lesson3.html">
       Lesson 3: Mathematical Expressions
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Troubleshooting_anyscript/intro.html">
     Trouble Shooting AnyScript Models
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../Validation_of_models/index.html">
     Validation of Models
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/>
    <label class="toctree-toggle" for="toctree-checkbox-20">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../Validation_of_models/intro.html">
       Introduction to validation
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Validation_of_models/Kinematic_input.html">
       Validating Kinematic input
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../about.html">
   <strong>
    About
   </strong>
  </a>
  <input checked class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/>
  <label class="toctree-toggle" for="toctree-checkbox-21">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../contributing.html">
     Help improve tutorials
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../legal.html">
     Legal, Trademarks and Copyrights
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav>
        </div>
        <div class="sidebar-end-items">
             <!-- To handle the deprecated key -->
            
                <div class="navbar_extra_footer">
                Tutorials by <a href="https://anybodytech.com">AnyBody Technology</a>
                </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>


      </div>
      <main class="bd-main">
        
        
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>

        <div class="bd-content">
          <div class="bd-article-container">
            
            <div class="bd-header-article">
                



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__primary"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/anybody/anybody-tutorial/issues/new?title=Issue%20on%20page%20%2FForceDependentKinematics/lesson2.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/anybody/anybody-tutorial/edit/master/ForceDependentKinematics/lesson2.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

    </div>
</div>
            </div>
            
            
<!-- Table of contents that is only displayed when printing the page -->
<div id="jb-print-docs-body" class="onlyprint">
    <h1>Lesson 2: Adding FDK Features</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

            <article class="bd-article" role="main">
              
  <section class="tex2jax_ignore mathjax_ignore" id="lesson-2-adding-fdk-features">
<h1>Lesson 2: Adding FDK Features<a class="headerlink" href="#lesson-2-adding-fdk-features" title="Permalink to this heading">#</a></h1>
<div class="caution margin admonition">
<p class="admonition-title"><strong>Old tutorial:</strong></p>
<p>This tutorial has not yet been updated to ver. 7 of the AnyBody Modeling System. Some concepts may have changed.</p>
</div>
<p>What we have now is a standard inverse dynamics AnyBody model capable of
computing forces in a knee joint that is presumed to be a simple hinge.
Real knees are unfortunately not as simple as that. Mechanically
speaking, the difference between an idealized revolute knee and a real
knee lies in the source of the forces which hold the joint together.</p>
<p>An idealized knee joint does not allow any deviations from its hinge
motion, like if the tibia and femur were to start sliding on one
another. This is accomplished by joint reaction forces which will
enforce the zero sliding constraint, regardless of how large the
required forces may be.</p>
<p>The real knee does not work like that. The cartilage cushioning the
contact between the femoral condyles and the tibial plateau is elastic,
and so are the ligaments and menisci stabilizing the knee against free
sliding. Since the forces in these passive structures depend on their
deformation, zero deformation implies the absence of any stabilizing
force. In other words, the knee MUST deform a little to invoke these
stabilizing forces and retain its integrity.</p>
<p>Let us begin the steps that will allow AnyBody to compute this
deformation. We zoom in on the definition of the knee joint and change
the definition of its reaction forces:</p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span><span class="kt">AnyRevoluteJoint</span> <span class="n">KneeJoint</span> <span class="o">=</span> <span class="p">{</span>
  <span class="kt">AnyRefFrame</span> <span class="o">&amp;</span><span class="n">Shank</span> <span class="o">=</span> <span class="p">.</span><span class="n">Shank</span><span class="p">.</span><span class="n">KneeCenter</span><span class="p">;</span>
  <span class="kt">AnyRefFrame</span> <span class="o">&amp;</span><span class="n">Thigh</span> <span class="o">=</span> <span class="p">.</span><span class="n">Thigh</span><span class="p">.</span><span class="n">KneeCenter</span><span class="p">;</span>
  <span class="gr"></span>
<span class="gr">  // Prepare the joint for FDK: Define the reaction types in x and y</span>
<span class="gr">  // directions to be FDK-dependent. These reaction forces must then</span>
<span class="gr">  // be switched off and provided by some elastic element that we</span>
<span class="gr">  // define explicitly below.</span>
<span class="gr">  Constraints = {</span>
<span class="gr">    CType = {ForceDep, ForceDep, Hard, Hard, Hard};</span>
<span class="gr">    Reaction.Type={Off,Off,On,On,On};</span>
<span class="gr">  }</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Here we redefine one of the default properties of the joint: the
definition of constraints. As mentioned in “Getting Started: AnyScript
Programming, Lesson 3: Connecting segments by joints”, connecting two
completely independent rigid segments with a joint arrests some or all
of the six degrees of relative motion freedom that existed between the
two.</p>
<p>In this manner, a revolute joint imposes five constraints of which the
first three are translational constraints (preventing relative sliding)
whose violation is resisted by the joint reaction forces and the latter
two are rotational constraints (preventing relative, out of plane
rotation) enforced by reaction moments.</p>
<p>The shank’s KneeCenter node - which is the joint’s default coordinate
system - has the <em>y</em> axis pointing proximally along the shank’s length
axis and the x axis pointing forward. These are the two directions in
which we’d like to introduce elastic stabilization of tibio-femoral
translation, so the first two components of the CType vector are changed
to the value ForceDep, which means that rather than being ‘Hard’
constraints, the forces are now defined by some elastic element, which
we shall introduce later. We are thus switching off the usual reaction
forces in those directions by setting the Reaction.Type vector.</p>
<p>Now let us add the necessary elasticity to the joint. This can be done
anywhere in the model, but we might as well place it just below the
joint:</p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span><span class="c1">// Knee joint. Notice that this is only going to be the nominal joint.</span>
<span class="c1">// The actual position of the knee joint center will depend on the forces</span>
<span class="c1">// acting upon it. Notice that we list the shank before the thigh. This</span>
<span class="c1">// defines the knee joint in the shank coordinate system and we can</span>
<span class="c1">// relate the reaction forces to the direction of the tibial plateau.</span>
<span class="kt">AnyRevoluteJoint</span> <span class="n">KneeJoint</span> <span class="o">=</span> <span class="p">{</span>
  <span class="kt">AnyRefFrame</span> <span class="o">&amp;</span><span class="n">Shank</span> <span class="o">=</span> <span class="p">.</span><span class="n">Shank</span><span class="p">.</span><span class="n">KneeCenter</span><span class="p">;</span>
  <span class="kt">AnyRefFrame</span> <span class="o">&amp;</span><span class="n">Thigh</span> <span class="o">=</span> <span class="p">.</span><span class="n">Thigh</span><span class="p">.</span><span class="n">KneeCenter</span><span class="p">;</span>
  <span class="c1">// Prepare the joint for FDK: Define the reaction types in x and y</span>
  <span class="c1">// directions to be FDK-dependent. These reaction forces must then</span>
  <span class="c1">// be switched off and provided by some elastic element that we</span>
  <span class="c1">// define explicitly below.</span>
  <span class="n">Constraints</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">CType</span> <span class="o">=</span> <span class="p">{</span><span class="kp">ForceDep</span><span class="p">,</span> <span class="kp">ForceDep</span><span class="p">,</span> <span class="kp">Hard</span><span class="p">,</span> <span class="kp">Hard</span><span class="p">,</span> <span class="kp">Hard</span><span class="p">};</span>
    <span class="n">Reaction</span><span class="p">.</span><span class="n">Type</span><span class="o">=</span><span class="p">{</span><span class="kp">Off</span><span class="p">,</span><span class="kp">Off</span><span class="p">,</span><span class="kp">On</span><span class="p">,</span><span class="kp">On</span><span class="p">,</span><span class="kp">On</span><span class="p">};</span>
  <span class="p">};</span>
<span class="p">};</span>
<span class="gr">// Define springs in the knee, simulating the effect of cartilage</span>
<span class="gr">// and ligaments.</span>
<span class="gr">AnyForce KneeStiffness = {</span>
<span class="gr">  AnyKinLinear &amp;lin = Main.MyModel.KneeJoint.Linear;</span>
<span class="gr">  F = {-1000*lin.Pos[0], -5000*lin.Pos[1], 0};</span>
<span class="gr">};</span>
</pre></div>
</div>
<p>We are using the AnyForce class for this purpose. AnyForce in an
abstract force that works on any kinematic measure we define inside it.
In this case, we simply refer to the linear measure which tracks the
distance between the two joint nodes on each segment. In an idealized
joint, this measure will always be zero as long as AnyBody can
successfully enforce all the translational constraints, however since
the first two components of CType are set to ‘ForceDep’, they can now
vary and become non-zero.</p>
<p>The <em>x</em> corresponds to sliding of the condyle along the tibial plateau.
In this direction, we can perceive the elasticity as primarily being
provided by the rim of the meniscus and the cruciate ligaments.</p>
<p>The <em>y</em> direction is along the shank’s long axis and in this direction,
the elasticity is provided by the layer of cartilage between the tibial
plateau and the femoral condyles. The <em>z</em> axis points laterally but
since we are building a planar model of the knee, we leave it to be a
conventional hard constraint.</p>
<p>It is therefore likely that the stiffness in the <em>y</em> direction is
somewhat larger than in the <em>x</em> direction. We are going to define it
that way and also choose values that are much smaller than in the real
knee to get some nice, large deformations that are visually perceivable.
So, the definition of the actual force inside the AnyForce object looks
like this:</p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span><span class="n">F</span> <span class="o">=</span> <span class="p">{</span><span class="o">-</span><span class="mi">1000</span> <span class="o">*</span> <span class="n">lin</span><span class="p">.</span><span class="n">Pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">5000</span> <span class="o">*</span> <span class="n">lin</span><span class="p">.</span><span class="n">Pos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">};</span>
</pre></div>
</div>
<p>As you can see, we simply specify the forces in the different directions
as mathematical functions of the Pos property of the lin measure. Pos
contains the actual linear displacements, and when we multiply those
with -1000 and -5000 respectively, we are generating spring forces that
are proportional and opposite to the translational deformation of the
joint. As discussed earlier, we have made the y direction stiffness five
times larger than the value for the <em>x</em> direction.</p>
<p>One of the beauties of the AnyScript language is that these expressions
can be as complicated as you want. So if you happen to know more
complex, realistic stiffness properties of the knee from a cadaver study
or from a detailed finite element model, then you could just as well
input those.</p>
<p>Let’s get the final part of the definition finalized. All that is
remaining is to tell the solver in AnyBody that it should apply
force-dependent kinematics to solve the problem. This is of course done
in the study section:</p>
<div class="highlight-AnyScriptDoc notranslate"><div class="highlight"><pre><span></span><span class="kt">AnyBodyStudy</span> <span class="n">Study</span> <span class="o">=</span> <span class="p">{</span>
  <span class="kt">AnyFolder</span> <span class="o">&amp;</span><span class="n">Model</span> <span class="o">=</span> <span class="p">.</span><span class="n">MyModel</span><span class="p">;</span>
  <span class="n">Gravity</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.81</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">};</span>
  <span class="n">tStart</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">tEnd</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
  <span class="n">nStep</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
  <span class="gr">InverseDynamics.ForceDepKinOnOff=On;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>That is all there is to it. The usual InverseDynamics operation will now
compute elastic deformations in the knee joint resulting from the
deformation of soft tissues in response to internal and external forces.
Go ahead and try it out. If something does not work, you can download a
functional model <a class="reference download internal" download="" href="../_downloads/1888c1c40d93fe68306c45eb7fc27d52/DemoSimpleKnee2.any"><code class="xref download docutils literal notranslate"><span class="pre">here</span></code></a>.</p>
<p><strong>TROUBLESHOOTING HELP</strong>: Inverse dynamics arrives at values of the
force dependent degrees of freedom (corresponding to the flexible joint
constraints) where the resulting passive stabilizing forces and computed
muscle forces, place those degrees of freedom in static equilibrium.
This is achieved by a gradient sensing optimizer which iteratively tries
out different combinations of joint deformation and muscle force
magnitudes which fulfil the equilibrium and optimization criteria.</p>
<p>It may therefore be necessary to adjust optimization settings of the
AnyBodyStudy class such as “InverseDynamics.ForceDepKin.MaxNewtonStep”
and “InverseDynamics.ForceDepKin.Perturbation”. For example, a large
perturbation size implies a large finite-difference step for the knee
translation values when the optimizer computes gradients numerically. If
the knee stiffness was extremely non-linear, this gradient might not
reflect the local behaviour of the functions which the optimizer is
working with.</p>
<p>When using more anatomically realistic body models containing passive
spring-like ligaments, it is good to ensure that the ligaments are
calibrated to ensure that their resting length isn’t too short or long.
You can read more on calibration in “Muscle Modeling, Lesson 7:
Ligaments” and “Inverse Dynamics of Muscle Systems, Lesson 7:
Calibration”.</p>
<p>In the next <a class="reference internal" href="lesson3.html"><span class="doc">lesson</span></a> we investigate the results in more detail.</p>
</section>


            </article>
            

            
            
            <footer class="bd-footer-article">
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="lesson1.html" title="previous page">
      <i class="fas fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title">Lesson 1: The Baseline Model</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="lesson3.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">Lesson 3: Results of FDK</p>
  </div>
  <i class="fas fa-angle-right"></i>
  </a>
</div>
            </footer>
            
          </div>
          
          

    <!-- Table of contents -->


<div class="bd-sidebar-secondary bd-toc show noprint">
</div>



        </div>
        <footer class="bd-footer-content">
          <div class="bd-footer-content__inner">
            <p>
  
    By AnyBody Technology<br/>
  
      &copy; Copyright 2022, AnyBody Technology.<br/>
</p>
          </div>
        </footer>
        

      </main>
    </div>
  </div>

  
    
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=9b1a4fa89bdd0e95b23b"></script>

  </body>
</html>